[
    {
        "id": "fbfe0ebdc384782c",
        "type": "tab",
        "label": "APTA",
        "disabled": false,
        "info": ""
    },
    {
        "id": "7cb4a59faa141113",
        "type": "tab",
        "label": "BioMed Central",
        "disabled": false,
        "info": ""
    },
    {
        "id": "aeea6501e40186b3",
        "type": "tab",
        "label": "PEDro",
        "disabled": false,
        "info": ""
    },
    {
        "id": "d9d95b7db82b44be",
        "type": "tab",
        "label": "Scielo",
        "disabled": false,
        "info": ""
    },
    {
        "id": "4e972c81ceb89218",
        "type": "tab",
        "label": "The Lancet",
        "disabled": true,
        "info": ""
    },
    {
        "id": "ef4efdb19a1e5bd7",
        "type": "tab",
        "label": "JNeuroSci",
        "disabled": false,
        "info": ""
    },
    {
        "id": "229c44d5bbf84eb1",
        "type": "tab",
        "label": "MS and Rel. Disorders",
        "disabled": true,
        "info": ""
    },
    {
        "id": "02847583794d9f3b",
        "type": "tab",
        "label": "Clinical Trials*",
        "disabled": false,
        "info": ""
    },
    {
        "id": "a38a4dce4a95b8aa",
        "type": "tab",
        "label": "!Journals.SagePub (not working)",
        "disabled": true,
        "info": ""
    },
    {
        "id": "d37ec6d25d6bf29f",
        "type": "tab",
        "label": "ND | 00. Setup and SQLite management",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "9dadc9b81f97dbb3",
        "type": "tab",
        "label": "ND | 01. Match journals",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "09606ddc1e1202f9",
        "type": "tab",
        "label": "ND | 01. Get MLA ref style",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "78a748492c9e884f",
        "type": "tab",
        "label": "ND | 02. Match authors to contentFul ids",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "d7f4697ea11dc8c3",
        "type": "tab",
        "label": "ND | 03. Publish to contentFul",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "f9371ec8fbbbf7f5",
        "type": "tab",
        "label": "DOI Fixer",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "ab5a10daa686af0d",
        "type": "tab",
        "label": "Abstract fixer",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "340c3340fec3e5d6",
        "type": "tab",
        "label": "Admin dashboard",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "9b68d310eda6df17",
        "type": "tab",
        "label": "ND | 04. API EndPoint",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "485626b8bcd6fdb0",
        "type": "tab",
        "label": "Fediverse | Articles",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "324a04c46cb08394",
        "type": "tab",
        "label": "Fediverse | Trials",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "1c5bb98919947223",
        "type": "tab",
        "label": "HumanSingularity",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "acf883d8.84eea",
        "type": "subflow",
        "name": "Create SQL Command",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 80,
                "wires": [
                    {
                        "id": "4c001d43.2cc414"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 340,
                "y": 80,
                "wires": [
                    {
                        "id": "4c001d43.2cc414",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "d353eec5835441c0",
        "type": "subflow",
        "name": "throttle requests",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 120,
                "y": 160,
                "wires": [
                    {
                        "id": "eb444d3ffa4f324c"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 660,
                "y": 160,
                "wires": [
                    {
                        "id": "d5716d48a6a85ee3",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "822a1abe384d181e",
        "type": "subflow",
        "name": "Add to DB",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 80,
                "wires": [
                    {
                        "id": "eb49695acf2247b5"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 540,
                "y": 80,
                "wires": [
                    {
                        "id": "948d3c8c302e2380",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "3d5c22a1ade8c013",
        "type": "subflow",
        "name": "Create SQL Command",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 80,
                "wires": [
                    {
                        "id": "a5116b9ed1662449"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 680,
                "y": 80,
                "wires": [
                    {
                        "id": "155c6a50daad47fa",
                        "port": 0
                    },
                    {
                        "id": "49e212b9f443fac4",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "346ec29c7e27ea2e",
        "type": "subflow",
        "name": "Add to DB (2)",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 80,
                "wires": [
                    {
                        "id": "7f8444988dff4341"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 540,
                "y": 80,
                "wires": [
                    {
                        "id": "2229ac4ea081f396",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "82e2e8495e59f259",
        "type": "group",
        "z": "d37ec6d25d6bf29f",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "06c65a4b27ef2525",
            "4a378e9c1364675e",
            "b5d69902238be226",
            "c33dfe3e5b3221e0",
            "5c148d1c110c8280",
            "5312a964a8391250",
            "0a5fab31f6197fa1",
            "bd98d6175c234f61",
            "84c58829eb54532c",
            "8315f76e2f4634be",
            "f9284596412a7158",
            "c39422c120711310",
            "2063a693ffa7e65b",
            "56952e14b1c2b837"
        ],
        "x": 14,
        "y": 779
    },
    {
        "id": "3b2ee211a0a8b13b",
        "type": "junction",
        "z": "d37ec6d25d6bf29f",
        "x": 600,
        "y": 380,
        "wires": [
            [
                "4658c54b039c6d72"
            ]
        ]
    },
    {
        "id": "e3876559.c845b8",
        "type": "tls-config",
        "name": "",
        "cert": "",
        "key": "",
        "ca": "",
        "certname": "node-cert.pem",
        "keyname": "node-key.pem",
        "caname": "",
        "servername": "",
        "verifyservercert": true
    },
    {
        "id": "9ccc1658.e12858",
        "type": "sqlitedb",
        "db": "/data/neurodiem.db",
        "mode": "RWC"
    },
    {
        "id": "58fc87aecc126c39",
        "type": "ui_base",
        "theme": {
            "name": "theme-light",
            "lightTheme": {
                "default": "#0094CE",
                "baseColor": "#0094CE",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "darkTheme": {
                "default": "#097479",
                "baseColor": "#097479",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": false
            },
            "customTheme": {
                "name": "Untitled Theme 1",
                "default": "#4B7930",
                "baseColor": "#4B7930",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
            },
            "themeState": {
                "base-color": {
                    "default": "#0094CE",
                    "value": "#0094CE",
                    "edited": false
                },
                "page-titlebar-backgroundColor": {
                    "value": "#0094CE",
                    "edited": false
                },
                "page-backgroundColor": {
                    "value": "#fafafa",
                    "edited": false
                },
                "page-sidebar-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-textColor": {
                    "value": "#1bbfff",
                    "edited": false
                },
                "group-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "widget-textColor": {
                    "value": "#111111",
                    "edited": false
                },
                "widget-backgroundColor": {
                    "value": "#0094ce",
                    "edited": false
                },
                "widget-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "base-font": {
                    "value": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
                }
            },
            "angularTheme": {
                "primary": "indigo",
                "accents": "blue",
                "warn": "red",
                "background": "grey",
                "palette": "light"
            }
        },
        "site": {
            "name": "Node-RED Dashboard",
            "hideToolbar": "false",
            "allowSwipe": "false",
            "lockMenu": "false",
            "allowTempTheme": "false",
            "dateFormat": "DD/MM/YYYY",
            "sizes": {
                "sx": 48,
                "sy": 48,
                "gx": 6,
                "gy": 6,
                "cx": 6,
                "cy": 6,
                "px": 0,
                "py": 0
            }
        }
    },
    {
        "id": "857f821ab371a10e",
        "type": "postgresdb",
        "cfgname": "",
        "hostname": "db",
        "port": "5432",
        "db": "gregorybackoffice",
        "ssl": false
    },
    {
        "id": "5e122bced9c00d59",
        "type": "ui_tab",
        "name": "ND",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "687a5ae4ec4e2c9a",
        "type": "ui_tab",
        "name": "DOI Fixer",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "d3d6df44b735a435",
        "type": "ui_group",
        "name": "Gregory DB",
        "tab": "687a5ae4ec4e2c9a",
        "order": 1,
        "disp": true,
        "width": "27",
        "collapse": false,
        "className": ""
    },
    {
        "id": "cfbd39c9af3a16fa",
        "type": "ui_group",
        "name": "Deleter",
        "tab": "ae3b8975ff5fe001",
        "order": 2,
        "disp": true,
        "width": "20",
        "collapse": false,
        "className": ""
    },
    {
        "id": "ae3b8975ff5fe001",
        "type": "ui_tab",
        "name": "Deleter",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "316f29573087ce1b",
        "type": "ui_tab",
        "name": "Abstracts",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "ae19737811987bc8",
        "type": "ui_group",
        "name": "Abstracts",
        "tab": "316f29573087ce1b",
        "order": 1,
        "disp": true,
        "width": "24",
        "collapse": false,
        "className": ""
    },
    {
        "id": "0f7ecac779093a20",
        "type": "ui_tab",
        "name": "Admin Dashboard",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "75b526ea0330d05d",
        "type": "ui_group",
        "name": "AdminDashboard",
        "tab": "0f7ecac779093a20",
        "order": 1,
        "disp": true,
        "width": "20",
        "collapse": false,
        "className": ""
    },
    {
        "id": "2989b888ee60422f",
        "type": "ui_spacer",
        "z": "340c3340fec3e5d6",
        "name": "spacer",
        "group": "75b526ea0330d05d",
        "order": 7,
        "width": 2,
        "height": 1
    },
    {
        "id": "db2719fa1c93d724",
        "type": "sqlitedb",
        "db": "/data/mastodon",
        "mode": "RWC"
    },
    {
        "id": "4053ba49e3ef12a2",
        "type": "ui_tab",
        "name": "Tab 6",
        "icon": "dashboard",
        "order": 6
    },
    {
        "id": "4374af16959005e4",
        "type": "sqlitedb",
        "db": "/data/human-singularity",
        "mode": "RWC"
    },
    {
        "id": "4c001d43.2cc414",
        "type": "template",
        "z": "acf883d8.84eea",
        "name": "",
        "field": "topic",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "INSERT INTO articles (discovery_date,title,summary,link,published_date,source,relevant)\nVALUES (strftime(\"%Y-%m-%dT%H:%M:%SZ\", \"NOW\"),\"{{article.title}}\",\"{{article.description}}\",\"{{{article.url}}}\",\"{{article.pubdate}}\",\"{{{article.source}}}\",NULL)",
        "output": "str",
        "x": 200,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "d5716d48a6a85ee3",
        "type": "delay",
        "z": "d353eec5835441c0",
        "name": "",
        "pauseType": "rate",
        "timeout": "500",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": true,
        "outputs": 1,
        "x": 490,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "eb444d3ffa4f324c",
        "type": "change",
        "z": "d353eec5835441c0",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "rate",
                "pt": "msg",
                "to": "200",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 320,
        "y": 160,
        "wires": [
            [
                "d5716d48a6a85ee3"
            ]
        ]
    },
    {
        "id": "eb49695acf2247b5",
        "type": "delay",
        "z": "822a1abe384d181e",
        "name": "",
        "pauseType": "random",
        "timeout": "500",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "200",
        "randomLast": "300",
        "randomUnits": "milliseconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 200,
        "y": 80,
        "wires": [
            [
                "948d3c8c302e2380"
            ]
        ]
    },
    {
        "id": "948d3c8c302e2380",
        "type": "sqlite",
        "z": "822a1abe384d181e",
        "mydb": "9ccc1658.e12858",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "",
        "x": 370,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "155c6a50daad47fa",
        "type": "template",
        "z": "3d5c22a1ade8c013",
        "name": "msg.payload",
        "field": "payload",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "INSERT INTO \"public\".\"articles\" (discovery_date,title,summary,link,published_date,source,relevant,kind,access)\nVALUES (current_timestamp,'{{article.title}}','{{article.description}}','{{{article.url}}}',{{article.pubdate}},{{source}},NULL,'science paper','unknown');",
        "output": "str",
        "x": 550,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "a5116b9ed1662449",
        "type": "switch",
        "z": "3d5c22a1ade8c013",
        "name": "",
        "property": "article.pubdate",
        "propertyType": "msg",
        "rules": [
            {
                "t": "empty"
            },
            {
                "t": "nempty"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 150,
        "y": 80,
        "wires": [
            [
                "b4c398bdb4db1159"
            ],
            [
                "49e212b9f443fac4"
            ]
        ]
    },
    {
        "id": "b4c398bdb4db1159",
        "type": "change",
        "z": "3d5c22a1ade8c013",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "article.pubdate",
                "pt": "msg",
                "to": "NULL",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 350,
        "y": 60,
        "wires": [
            [
                "155c6a50daad47fa"
            ]
        ]
    },
    {
        "id": "49e212b9f443fac4",
        "type": "template",
        "z": "3d5c22a1ade8c013",
        "name": "msg.payload",
        "field": "payload",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "INSERT INTO \"public\".\"articles\" (discovery_date,title,summary,link,published_date,source,relevant,kind,access)\nVALUES (current_timestamp,'{{article.title}}','{{article.description}}','{{{article.url}}}','{{article.pubdate}}',{{source}},NULL,'science paper','unknown');",
        "output": "str",
        "x": 550,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "7f8444988dff4341",
        "type": "delay",
        "z": "346ec29c7e27ea2e",
        "name": "",
        "pauseType": "random",
        "timeout": "500",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "200",
        "randomLast": "300",
        "randomUnits": "milliseconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 200,
        "y": 80,
        "wires": [
            [
                "2229ac4ea081f396"
            ]
        ]
    },
    {
        "id": "2229ac4ea081f396",
        "type": "sqlite",
        "z": "346ec29c7e27ea2e",
        "mydb": "9ccc1658.e12858",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "",
        "x": 370,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "5b4cc8a6a207c41e",
        "type": "inject",
        "z": "fbfe0ebdc384782c",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "source",
                "v": "1",
                "vt": "num"
            }
        ],
        "repeat": "10800",
        "crontab": "",
        "once": true,
        "onceDelay": "30",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 80,
        "wires": [
            [
                "a17ed06224887385"
            ]
        ]
    },
    {
        "id": "a17ed06224887385",
        "type": "http request",
        "z": "fbfe0ebdc384782c",
        "name": "APTA",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://www.apta.org/search?Q=%22Multiple+Sclerosis%22+OR+%22autoimmune+encephalomyelitis%22+OR+encephalomyelitis+OR+%22immune+tolerance%22+OR+myelin&searcharticletypes=8834&searchconditionandsymptoms=&searchloc=APTA",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 310,
        "y": 80,
        "wires": [
            [
                "03766f3c785ad93c"
            ]
        ]
    },
    {
        "id": "065c06f5634a087c",
        "type": "change",
        "z": "fbfe0ebdc384782c",
        "name": "set source APTA",
        "rules": [
            {
                "t": "set",
                "p": "payload.link",
                "pt": "msg",
                "to": "\"https://www.apta.org\" & payload.link",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "article.pubdate",
                "pt": "msg",
                "to": "",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload.kind",
                "pt": "msg",
                "to": "science paper",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload.source_id",
                "pt": "msg",
                "to": "1",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 200,
        "y": 160,
        "wires": [
            [
                "4c80b653c33f16f2"
            ]
        ]
    },
    {
        "id": "4ab276e0977c12ba",
        "type": "split",
        "z": "fbfe0ebdc384782c",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "article.key",
        "x": 870,
        "y": 80,
        "wires": [
            [
                "065c06f5634a087c",
                "ffce408cf068e315"
            ]
        ]
    },
    {
        "id": "03766f3c785ad93c",
        "type": "cheerio",
        "z": "fbfe0ebdc384782c",
        "name": "",
        "tag": "div.mg-n40px div.mb-40px",
        "ret": "object",
        "as": "single",
        "map": [
            {
                "search": "a",
                "ret": "text",
                "replace": "title",
                "attr": ""
            },
            {
                "search": "a",
                "ret": "attribute",
                "replace": "link",
                "attr": "href"
            },
            {
                "search": "p + p",
                "ret": "text",
                "replace": "abstract",
                "attr": ""
            },
            {
                "search": "p.text-uppercase.text-muted.ff-apta-sans.fw-600.fs-14px",
                "ret": "text",
                "replace": "pubdate",
                "attr": ""
            }
        ],
        "xmlMode": false,
        "decodeEntities": false,
        "lowerCaseTags": false,
        "lowerCaseAttributeNames": true,
        "recognizeCDATA": false,
        "recognizeSelfClosing": false,
        "x": 500,
        "y": 80,
        "wires": [
            [
                "4ab276e0977c12ba"
            ]
        ]
    },
    {
        "id": "d4a8a2373966c19d",
        "type": "http request",
        "z": "fbfe0ebdc384782c",
        "name": "",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://api.gregory-ms.com/articles/post/",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "other",
                "keyValue": "Authorization",
                "valueType": "other",
                "valueValue": "API KEY"
            }
        ],
        "x": 570,
        "y": 280,
        "wires": [
            [
                "4b152ff84e870409",
                "80bd91a5acf18584"
            ]
        ]
    },
    {
        "id": "4b152ff84e870409",
        "type": "json",
        "z": "fbfe0ebdc384782c",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 790,
        "y": 300,
        "wires": [
            [
                "80bd91a5acf18584"
            ]
        ]
    },
    {
        "id": "4c80b653c33f16f2",
        "type": "delay",
        "z": "fbfe0ebdc384782c",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "minutes",
        "rate": "1",
        "nbRateUnits": "20",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 420,
        "y": 200,
        "wires": [
            [
                "d4a8a2373966c19d",
                "80bd91a5acf18584"
            ]
        ]
    },
    {
        "id": "80bd91a5acf18584",
        "type": "debug",
        "z": "fbfe0ebdc384782c",
        "name": "debug 30",
        "active": true,
        "tosidebar": false,
        "console": true,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 970,
        "y": 160,
        "wires": []
    },
    {
        "id": "ffce408cf068e315",
        "type": "debug",
        "z": "fbfe0ebdc384782c",
        "name": "debug 43",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1170,
        "y": 100,
        "wires": []
    },
    {
        "id": "ded32c3565228fff",
        "type": "inject",
        "z": "7cb4a59faa141113",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "source",
                "v": "2",
                "vt": "num"
            }
        ],
        "repeat": "7200",
        "crontab": "",
        "once": true,
        "onceDelay": "30",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 60,
        "wires": [
            [
                "e3a4683ca66fb52c"
            ]
        ]
    },
    {
        "id": "e3a4683ca66fb52c",
        "type": "http request",
        "z": "7cb4a59faa141113",
        "name": "BioMedCentral",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://www.biomedcentral.com/search?searchType=publisherSearch&sort=PubDate&page=1&query=Multiple+Sclerosis",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 300,
        "y": 60,
        "wires": [
            [
                "9e82b809fcf840ee"
            ]
        ]
    },
    {
        "id": "e8bfa0ad8b138733",
        "type": "change",
        "z": "7cb4a59faa141113",
        "name": "set source BioMedCentral",
        "rules": [
            {
                "t": "set",
                "p": "article.url",
                "pt": "msg",
                "to": "\"https:\" & payload.link",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "article.source",
                "pt": "msg",
                "to": "BioMedCentral",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "article.description",
                "pt": "msg",
                "to": "$trim(article.description)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "article.title",
                "pt": "msg",
                "to": "$trim(article.title)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "article.doi",
                "pt": "msg",
                "to": "$substringAfter( payload.link, '/articles/')\t",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 210,
        "y": 200,
        "wires": [
            [
                "9c729ed7e11b9e20"
            ]
        ]
    },
    {
        "id": "dcd533445597851c",
        "type": "split",
        "z": "7cb4a59faa141113",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "article.key",
        "x": 250,
        "y": 120,
        "wires": [
            [
                "870f0c26744f2ad9"
            ]
        ]
    },
    {
        "id": "9e82b809fcf840ee",
        "type": "cheerio",
        "z": "7cb4a59faa141113",
        "name": "",
        "tag": "article.c-listing__content",
        "ret": "object",
        "as": "single",
        "map": [
            {
                "search": "article > h3",
                "ret": "text",
                "replace": "title",
                "attr": ""
            },
            {
                "search": "a[itemprop=\"url\"]",
                "ret": "attribute",
                "replace": "link",
                "attr": "href"
            },
            {
                "search": "p.c-listing__text",
                "ret": "text",
                "replace": "description",
                "attr": ""
            },
            {
                "search": "span[itemprop=\"datePublished\"]",
                "ret": "text",
                "replace": "pubdate",
                "attr": ""
            }
        ],
        "xmlMode": false,
        "decodeEntities": false,
        "lowerCaseTags": false,
        "lowerCaseAttributeNames": true,
        "recognizeCDATA": false,
        "recognizeSelfClosing": false,
        "x": 510,
        "y": 60,
        "wires": [
            [
                "dcd533445597851c"
            ]
        ]
    },
    {
        "id": "870f0c26744f2ad9",
        "type": "switch",
        "z": "7cb4a59faa141113",
        "name": "",
        "property": "payload.title",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 370,
        "y": 120,
        "wires": [
            [
                "eabccdc8c2689377"
            ]
        ]
    },
    {
        "id": "eabccdc8c2689377",
        "type": "change",
        "z": "7cb4a59faa141113",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "article",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 520,
        "y": 120,
        "wires": [
            [
                "abb572a1fcee3c9a"
            ]
        ]
    },
    {
        "id": "abb572a1fcee3c9a",
        "type": "moment",
        "z": "7cb4a59faa141113",
        "name": "format pubdate",
        "topic": "",
        "input": "payload.pubdate",
        "inputType": "msg",
        "inTz": "Europe/Lisbon",
        "adjAmount": 0,
        "adjType": "days",
        "adjDir": "add",
        "format": "",
        "locale": "en-US",
        "output": "article.pubdate",
        "outputType": "msg",
        "outTz": "Europe/Lisbon",
        "x": 700,
        "y": 120,
        "wires": [
            [
                "e8bfa0ad8b138733"
            ]
        ]
    },
    {
        "id": "9c729ed7e11b9e20",
        "type": "change",
        "z": "7cb4a59faa141113",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "article",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload.link",
                "pt": "msg",
                "to": "payload.url",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload.published_date",
                "pt": "msg",
                "to": "payload.pubdate",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload.kind",
                "pt": "msg",
                "to": "science paper",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload.source_id",
                "pt": "msg",
                "to": "2",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 420,
        "y": 200,
        "wires": [
            [
                "7da14104220d21db",
                "9456546b7dad9b62"
            ]
        ]
    },
    {
        "id": "b1ea10937b8af0c6",
        "type": "http request",
        "z": "7cb4a59faa141113",
        "name": "",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://api.gregory-ms.com/articles/post/",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "other",
                "keyValue": "Authorization",
                "valueType": "other",
                "valueValue": "API KEY"
            }
        ],
        "x": 410,
        "y": 260,
        "wires": [
            [
                "276fd8083cda6ab3"
            ]
        ]
    },
    {
        "id": "7da14104220d21db",
        "type": "delay",
        "z": "7cb4a59faa141113",
        "name": "",
        "pauseType": "rate",
        "timeout": "20",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "10",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 740,
        "y": 200,
        "wires": [
            [
                "b1ea10937b8af0c6"
            ]
        ]
    },
    {
        "id": "276fd8083cda6ab3",
        "type": "json",
        "z": "7cb4a59faa141113",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 590,
        "y": 340,
        "wires": [
            [
                "9456546b7dad9b62"
            ]
        ]
    },
    {
        "id": "9456546b7dad9b62",
        "type": "debug",
        "z": "7cb4a59faa141113",
        "name": "debug 33",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 910,
        "y": 260,
        "wires": []
    },
    {
        "id": "6ca4bc9cf9ef1874",
        "type": "http request",
        "z": "aeea6501e40186b3",
        "name": "PEDro",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://search.pedro.org.au/advanced-search/results?abstract_with_title=Multiple+Sclerosis&therapy=0&problem=0&body_part=0&subdiscipline=0&topic=0&method=0&authors_association=&title=&source=&year_of_publication=&date_record_was_created=&nscore=&perpage=20&lop=or&find=&find=Start+Search",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 290,
        "y": 80,
        "wires": [
            [
                "bfc4e86aa16d2aff",
                "45fdacaf6ccd9508"
            ]
        ]
    },
    {
        "id": "20609624c4f52855",
        "type": "split",
        "z": "aeea6501e40186b3",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "article.key",
        "x": 430,
        "y": 160,
        "wires": [
            [
                "a4e284ba326df0a9"
            ]
        ]
    },
    {
        "id": "5c7a83a8ed482567",
        "type": "change",
        "z": "aeea6501e40186b3",
        "name": "set source PEDro",
        "rules": [
            {
                "t": "set",
                "p": "article.source",
                "pt": "msg",
                "to": "PEDro",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "article.description",
                "pt": "msg",
                "to": "",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "article.title",
                "pt": "msg",
                "to": "$trim(article.title)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.kind",
                "pt": "msg",
                "to": "science paper",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload.source_id",
                "pt": "msg",
                "to": "7",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 430,
        "y": 220,
        "wires": [
            [
                "39a38cacb54f5636"
            ]
        ]
    },
    {
        "id": "8349b15c6e856988",
        "type": "inject",
        "z": "aeea6501e40186b3",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "source",
                "v": "7",
                "vt": "num"
            }
        ],
        "repeat": "13200",
        "crontab": "",
        "once": true,
        "onceDelay": "300",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 80,
        "wires": [
            [
                "6ca4bc9cf9ef1874"
            ]
        ]
    },
    {
        "id": "bfc4e86aa16d2aff",
        "type": "cheerio",
        "z": "aeea6501e40186b3",
        "name": "",
        "tag": "table.search-results tr",
        "ret": "object",
        "as": "single",
        "map": [
            {
                "search": "td>a",
                "ret": "text",
                "replace": "title",
                "attr": ""
            },
            {
                "search": "td>a",
                "ret": "attribute",
                "replace": "link",
                "attr": "href"
            },
            {
                "search": "p.NoSummary",
                "ret": "text",
                "replace": "description",
                "attr": ""
            },
            {
                "search": "p.NoDate",
                "ret": "text",
                "replace": "pubdate",
                "attr": ""
            }
        ],
        "xmlMode": false,
        "decodeEntities": false,
        "lowerCaseTags": false,
        "lowerCaseAttributeNames": true,
        "recognizeCDATA": false,
        "recognizeSelfClosing": false,
        "x": 260,
        "y": 160,
        "wires": [
            [
                "20609624c4f52855"
            ]
        ]
    },
    {
        "id": "a4e284ba326df0a9",
        "type": "moment",
        "z": "aeea6501e40186b3",
        "name": "format pubdate",
        "topic": "",
        "input": "payload.pubdate",
        "inputType": "msg",
        "inTz": "Europe/Lisbon",
        "adjAmount": 0,
        "adjType": "days",
        "adjDir": "add",
        "format": "",
        "locale": "en-US",
        "output": "article.pubdate",
        "outputType": "msg",
        "outTz": "Europe/Lisbon",
        "x": 220,
        "y": 220,
        "wires": [
            [
                "5c7a83a8ed482567"
            ]
        ]
    },
    {
        "id": "0df4987f3ba453d3",
        "type": "http request",
        "z": "aeea6501e40186b3",
        "name": "",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://api.gregory-ms.com/articles/post/",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "other",
                "keyValue": "Authorization",
                "valueType": "other",
                "valueValue": "API KEY"
            }
        ],
        "x": 810,
        "y": 160,
        "wires": [
            [
                "8a5b16567644c697"
            ]
        ]
    },
    {
        "id": "8a5b16567644c697",
        "type": "json",
        "z": "aeea6501e40186b3",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 950,
        "y": 160,
        "wires": [
            [
                "45fdacaf6ccd9508"
            ]
        ]
    },
    {
        "id": "39a38cacb54f5636",
        "type": "delay",
        "z": "aeea6501e40186b3",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "2",
        "nbRateUnits": "1",
        "rateUnits": "minute",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 640,
        "y": 160,
        "wires": [
            [
                "0df4987f3ba453d3"
            ]
        ]
    },
    {
        "id": "45fdacaf6ccd9508",
        "type": "debug",
        "z": "aeea6501e40186b3",
        "name": "debug 34",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1150,
        "y": 160,
        "wires": []
    },
    {
        "id": "16c74b04ea56243b",
        "type": "http request",
        "z": "d9d95b7db82b44be",
        "name": "Scielo.org",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://search.scielo.org/?q=Multiple+Sclerosis&lang=en&count=15&from=0&output=site&sort=&format=summary&fb=&page=1&q=%22Multiple+Sclerosis%22+OR+%22autoimmune+encephalomyelitis%22+OR+encephalomyelitis+OR+%22immune+tolerance%22+OR+myelin&lang=en&page=1",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 280,
        "y": 100,
        "wires": [
            [
                "083ae1a1b58a4a41"
            ]
        ]
    },
    {
        "id": "4ca28f31ea6cae54",
        "type": "inject",
        "z": "d9d95b7db82b44be",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "source",
                "v": "10",
                "vt": "num"
            }
        ],
        "repeat": "14400",
        "crontab": "",
        "once": true,
        "onceDelay": "39",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 100,
        "wires": [
            [
                "16c74b04ea56243b"
            ]
        ]
    },
    {
        "id": "f164da5fa3925368",
        "type": "split",
        "z": "d9d95b7db82b44be",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "article.key",
        "x": 650,
        "y": 100,
        "wires": [
            [
                "5e86cfaa4d3a269e"
            ]
        ]
    },
    {
        "id": "a51f984e20faef33",
        "type": "change",
        "z": "d9d95b7db82b44be",
        "name": "set source Scielo",
        "rules": [
            {
                "t": "set",
                "p": "article.description",
                "pt": "msg",
                "to": "$trim(article.description)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "article.title",
                "pt": "msg",
                "to": "$trim(article.title)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.kind",
                "pt": "msg",
                "to": "science paper",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload.source_id",
                "pt": "msg",
                "to": "10",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 330,
        "y": 160,
        "wires": [
            [
                "1ac54d4427d699bf"
            ]
        ]
    },
    {
        "id": "083ae1a1b58a4a41",
        "type": "cheerio",
        "z": "d9d95b7db82b44be",
        "name": "",
        "tag": "div.results div.item",
        "ret": "object",
        "as": "single",
        "map": [
            {
                "search": "strong.title",
                "ret": "text",
                "replace": "title",
                "attr": ""
            },
            {
                "search": "div.line a",
                "ret": "attribute",
                "replace": "link",
                "attr": "href"
            },
            {
                "search": "p.NoSummary",
                "ret": "text",
                "replace": "description",
                "attr": ""
            },
            {
                "search": "p.NoDate",
                "ret": "text",
                "replace": "pubdate",
                "attr": ""
            }
        ],
        "xmlMode": false,
        "decodeEntities": false,
        "lowerCaseTags": false,
        "lowerCaseAttributeNames": true,
        "recognizeCDATA": false,
        "recognizeSelfClosing": false,
        "x": 470,
        "y": 100,
        "wires": [
            [
                "f164da5fa3925368"
            ]
        ]
    },
    {
        "id": "28ad2bac566388f6",
        "type": "moment",
        "z": "d9d95b7db82b44be",
        "name": "format pubdate",
        "topic": "",
        "input": "payload.pubdate",
        "inputType": "msg",
        "inTz": "Europe/Lisbon",
        "adjAmount": 0,
        "adjType": "days",
        "adjDir": "add",
        "format": "",
        "locale": "en-US",
        "output": "article.pubdate",
        "outputType": "msg",
        "outTz": "Europe/Lisbon",
        "x": 140,
        "y": 160,
        "wires": [
            [
                "a51f984e20faef33"
            ]
        ]
    },
    {
        "id": "1ac54d4427d699bf",
        "type": "http request",
        "z": "d9d95b7db82b44be",
        "name": "",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://api.gregory-ms.com/articles/post/",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "other",
                "keyValue": "Authorization",
                "valueType": "other",
                "valueValue": "API KEY"
            }
        ],
        "x": 550,
        "y": 160,
        "wires": [
            [
                "c848bcdf0556bb55"
            ]
        ]
    },
    {
        "id": "c848bcdf0556bb55",
        "type": "json",
        "z": "d9d95b7db82b44be",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 690,
        "y": 160,
        "wires": [
            [
                "069f1153ec2d5935"
            ]
        ]
    },
    {
        "id": "5e86cfaa4d3a269e",
        "type": "delay",
        "z": "d9d95b7db82b44be",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "10",
        "nbRateUnits": "60",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 800,
        "y": 100,
        "wires": [
            [
                "28ad2bac566388f6"
            ]
        ]
    },
    {
        "id": "069f1153ec2d5935",
        "type": "debug",
        "z": "d9d95b7db82b44be",
        "name": "debug 35",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 890,
        "y": 160,
        "wires": []
    },
    {
        "id": "5ac626db3ff4e0e2",
        "type": "http request",
        "z": "4e972c81ceb89218",
        "name": "The Lancet",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://www.thelancet.com/action/doSearch?text1=%22Multiple+Sclerosis%22+OR+%22autoimmune+encephalomyelitis%22+OR+encephalomyelitis+OR+%22immune+tolerance%22+OR+myelin&field1=AbstractTitleKeywordFilterField&startPage=0&sortBy=Earliest",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 310,
        "y": 60,
        "wires": [
            [
                "62b4fe6ef6a3b08b",
                "b7609a7ee3142810"
            ]
        ]
    },
    {
        "id": "58630f8e493b6e27",
        "type": "inject",
        "z": "4e972c81ceb89218",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "14400",
        "crontab": "",
        "once": true,
        "onceDelay": "67",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 60,
        "wires": [
            [
                "5ac626db3ff4e0e2"
            ]
        ]
    },
    {
        "id": "9fa5189eb58baf3a",
        "type": "split",
        "z": "4e972c81ceb89218",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "article.key",
        "x": 750,
        "y": 60,
        "wires": [
            [
                "a33a097f46044af2"
            ]
        ]
    },
    {
        "id": "a33a097f46044af2",
        "type": "change",
        "z": "4e972c81ceb89218",
        "name": "configure payload",
        "rules": [
            {
                "t": "set",
                "p": "article",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload.link",
                "pt": "msg",
                "to": "\"https://www.thelancet.com\" & payload.link",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.source_id",
                "pt": "msg",
                "to": "11",
                "tot": "num"
            },
            {
                "t": "set",
                "p": "payload.abstract",
                "pt": "msg",
                "to": "$trim(article.description)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.title",
                "pt": "msg",
                "to": "$trim(article.title)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "article.pubdate",
                "pt": "msg",
                "to": "$trim($replace(article.pubdate, \"Published: \", \" \"))",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.kind",
                "pt": "msg",
                "to": "science paper",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 950,
        "y": 60,
        "wires": [
            [
                "3b49fba804e53306"
            ]
        ]
    },
    {
        "id": "62b4fe6ef6a3b08b",
        "type": "cheerio",
        "z": "4e972c81ceb89218",
        "name": "",
        "tag": "div.search__item__body",
        "ret": "object",
        "as": "single",
        "map": [
            {
                "search": "h4.meta__title",
                "ret": "text",
                "replace": "title",
                "attr": ""
            },
            {
                "search": "h4.meta__title a",
                "ret": "attribute",
                "replace": "link",
                "attr": "href"
            },
            {
                "search": "p.NoSummary",
                "ret": "text",
                "replace": "description",
                "attr": ""
            },
            {
                "search": "p.meta__details > span:nth-child(5)",
                "ret": "text",
                "replace": "pubdate",
                "attr": ""
            }
        ],
        "xmlMode": false,
        "decodeEntities": false,
        "lowerCaseTags": false,
        "lowerCaseAttributeNames": true,
        "recognizeCDATA": false,
        "recognizeSelfClosing": false,
        "x": 550,
        "y": 60,
        "wires": [
            [
                "9fa5189eb58baf3a"
            ]
        ]
    },
    {
        "id": "3b49fba804e53306",
        "type": "moment",
        "z": "4e972c81ceb89218",
        "name": "format pubdate",
        "topic": "",
        "input": "payload.pubdate",
        "inputType": "msg",
        "inTz": "Europe/Lisbon",
        "adjAmount": 0,
        "adjType": "days",
        "adjDir": "add",
        "format": "",
        "locale": "en-US",
        "output": "payload.published_date",
        "outputType": "msg",
        "outTz": "Europe/Lisbon",
        "x": 180,
        "y": 140,
        "wires": [
            [
                "d30b79928b5b4ca8"
            ]
        ]
    },
    {
        "id": "aff23de0626e0c74",
        "type": "http request",
        "z": "4e972c81ceb89218",
        "name": "",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://api.gregory-ms.com/articles/post/",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "other",
                "keyValue": "Authorization",
                "valueType": "other",
                "valueValue": "API KEY"
            }
        ],
        "x": 550,
        "y": 140,
        "wires": [
            [
                "0ac56cb87ac61563"
            ]
        ]
    },
    {
        "id": "0ac56cb87ac61563",
        "type": "json",
        "z": "4e972c81ceb89218",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 690,
        "y": 220,
        "wires": [
            [
                "b7609a7ee3142810"
            ]
        ]
    },
    {
        "id": "d30b79928b5b4ca8",
        "type": "delay",
        "z": "4e972c81ceb89218",
        "name": "",
        "pauseType": "rate",
        "timeout": "20",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "30",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 380,
        "y": 140,
        "wires": [
            [
                "aff23de0626e0c74"
            ]
        ]
    },
    {
        "id": "b7609a7ee3142810",
        "type": "debug",
        "z": "4e972c81ceb89218",
        "name": "debug 36",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 940,
        "y": 140,
        "wires": []
    },
    {
        "id": "039626468bc32112",
        "type": "http request",
        "z": "ef4efdb19a1e5bd7",
        "name": "JNeuroSci",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://www.jneurosci.org/search/text_abstract_title%3AMultiple%2BSclerosis%20text_abstract_title_flags%3Amatch-phrase%20exclude_meeting_abstracts%3A1%20numresults%3A50%20sort%3Apublication-date%20direction%3Adescending%20format_result%3Astandard",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 290,
        "y": 60,
        "wires": [
            [
                "e356666273992ab4"
            ]
        ]
    },
    {
        "id": "303a68bba79a02bc",
        "type": "split",
        "z": "ef4efdb19a1e5bd7",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "article.key",
        "x": 610,
        "y": 60,
        "wires": [
            [
                "6b19aa32c6323140"
            ]
        ]
    },
    {
        "id": "6b19aa32c6323140",
        "type": "change",
        "z": "ef4efdb19a1e5bd7",
        "name": "set source JNeuroSci",
        "rules": [
            {
                "t": "set",
                "p": "article",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload.link",
                "pt": "msg",
                "to": "\"https://www.jneurosci.org\" & payload.link",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.source_id",
                "pt": "msg",
                "to": "4",
                "tot": "num"
            },
            {
                "t": "set",
                "p": "payload.abstract",
                "pt": "msg",
                "to": "$trim(article.description)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.title",
                "pt": "msg",
                "to": "$trim(article.title)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "article.pubdate",
                "pt": "msg",
                "to": "$trim($replace(article.pubdate, \"Published: \", \" \"))",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.kind",
                "pt": "msg",
                "to": "science paper",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 780,
        "y": 60,
        "wires": [
            [
                "bac2388b91c13478"
            ]
        ]
    },
    {
        "id": "51e8e5a7e5c118a1",
        "type": "inject",
        "z": "ef4efdb19a1e5bd7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "source",
                "v": "4",
                "vt": "num"
            }
        ],
        "repeat": "13800",
        "crontab": "",
        "once": true,
        "onceDelay": "85",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 60,
        "wires": [
            [
                "039626468bc32112"
            ]
        ]
    },
    {
        "id": "e356666273992ab4",
        "type": "cheerio",
        "z": "ef4efdb19a1e5bd7",
        "name": "",
        "tag": "li.search-result",
        "ret": "object",
        "as": "single",
        "map": [
            {
                "search": "a",
                "ret": "text",
                "replace": "title",
                "attr": ""
            },
            {
                "search": "a",
                "ret": "attribute",
                "replace": "link",
                "attr": "href"
            },
            {
                "search": "p.NoSummary",
                "ret": "text",
                "replace": "description",
                "attr": ""
            },
            {
                "search": "p.NoDate",
                "ret": "text",
                "replace": "pubdate",
                "attr": ""
            }
        ],
        "xmlMode": false,
        "decodeEntities": false,
        "lowerCaseTags": false,
        "lowerCaseAttributeNames": true,
        "recognizeCDATA": false,
        "recognizeSelfClosing": false,
        "x": 460,
        "y": 60,
        "wires": [
            [
                "303a68bba79a02bc"
            ]
        ]
    },
    {
        "id": "bac2388b91c13478",
        "type": "moment",
        "z": "ef4efdb19a1e5bd7",
        "name": "format pubdate",
        "topic": "",
        "input": "payload.pubdate",
        "inputType": "msg",
        "inTz": "Europe/Lisbon",
        "adjAmount": 0,
        "adjType": "days",
        "adjDir": "add",
        "format": "",
        "locale": "en-US",
        "output": "payload.published_date",
        "outputType": "msg",
        "outTz": "Europe/Lisbon",
        "x": 160,
        "y": 120,
        "wires": [
            [
                "7ba6e151693d9df3"
            ]
        ]
    },
    {
        "id": "0c6f992a3c5a21fa",
        "type": "debug",
        "z": "ef4efdb19a1e5bd7",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1700,
        "y": 300,
        "wires": []
    },
    {
        "id": "10f67398ebef080d",
        "type": "http request",
        "z": "ef4efdb19a1e5bd7",
        "name": "",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://api.gregory-ms.com/articles/post/",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "other",
                "keyValue": "Authorization",
                "valueType": "other",
                "valueValue": "API KEY"
            }
        ],
        "x": 510,
        "y": 120,
        "wires": [
            [
                "5d102ab750608ddc"
            ]
        ]
    },
    {
        "id": "5d102ab750608ddc",
        "type": "json",
        "z": "ef4efdb19a1e5bd7",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 710,
        "y": 280,
        "wires": [
            [
                "a65f5f5a500b0112"
            ]
        ]
    },
    {
        "id": "7ba6e151693d9df3",
        "type": "delay",
        "z": "ef4efdb19a1e5bd7",
        "name": "",
        "pauseType": "rate",
        "timeout": "20",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "10",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 340,
        "y": 120,
        "wires": [
            [
                "10f67398ebef080d"
            ]
        ]
    },
    {
        "id": "a65f5f5a500b0112",
        "type": "debug",
        "z": "ef4efdb19a1e5bd7",
        "name": "debug 37",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 810,
        "y": 160,
        "wires": []
    },
    {
        "id": "c22a488e48d215a7",
        "type": "inject",
        "z": "229c44d5bbf84eb1",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "source",
                "v": "5",
                "vt": "num"
            }
        ],
        "repeat": "13800",
        "crontab": "",
        "once": true,
        "onceDelay": "200",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 166.66665649414062,
        "y": 101.66666412353516,
        "wires": [
            [
                "c40795eb5c087a68"
            ]
        ]
    },
    {
        "id": "c40795eb5c087a68",
        "type": "http request",
        "z": "229c44d5bbf84eb1",
        "name": "MS and Rel. Disorders",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://www.msard-journal.com/action/doSearch?text1=Multiple+Sclerosis&field1=AbstractTitleKeywordFilterField&startPage=0&sortBy=Earliest",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 386.6666564941406,
        "y": 101.66666412353516,
        "wires": [
            [
                "8725784d152fc0f0",
                "feac5db07c171304"
            ]
        ]
    },
    {
        "id": "c29535e4bd0b786a",
        "type": "split",
        "z": "229c44d5bbf84eb1",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "article.key",
        "x": 750,
        "y": 100,
        "wires": [
            [
                "cae37559e966fc39"
            ]
        ]
    },
    {
        "id": "cae37559e966fc39",
        "type": "change",
        "z": "229c44d5bbf84eb1",
        "name": "set source MS & rel. disorders",
        "rules": [
            {
                "t": "set",
                "p": "article",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload.link",
                "pt": "msg",
                "to": "\"https://www.msard-journal.com\" & payload.link",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.abstract",
                "pt": "msg",
                "to": "",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload.title",
                "pt": "msg",
                "to": "$trim(article.title)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.source_id",
                "pt": "msg",
                "to": "5",
                "tot": "num"
            },
            {
                "t": "set",
                "p": "payload.kind",
                "pt": "msg",
                "to": "science paper",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 950,
        "y": 100,
        "wires": [
            [
                "daec510a359a8f0f"
            ]
        ]
    },
    {
        "id": "daec510a359a8f0f",
        "type": "change",
        "z": "229c44d5bbf84eb1",
        "name": "fix pubdate",
        "rules": [
            {
                "t": "set",
                "p": "payload.published_date",
                "pt": "msg",
                "to": "$replace(\t    $replace(\t        $replace(\t            published_date,\" \", \"-\"),\t            \"Published-online:-\",\"\"), \t                \",\",\"\")",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 170,
        "y": 160,
        "wires": [
            [
                "26eb1525168a4179"
            ]
        ]
    },
    {
        "id": "8725784d152fc0f0",
        "type": "cheerio",
        "z": "229c44d5bbf84eb1",
        "name": "",
        "tag": "li.search__item",
        "ret": "object",
        "as": "single",
        "map": [
            {
                "search": "h4.meta__title",
                "ret": "text",
                "replace": "title",
                "attr": ""
            },
            {
                "search": "h4.meta__title>a",
                "ret": "attribute",
                "replace": "link",
                "attr": "href"
            },
            {
                "search": "div.hlFld-Abstract.preview-abstract",
                "ret": "text",
                "replace": "description",
                "attr": ""
            },
            {
                "search": "p.meta__details > span:nth-child(3)",
                "ret": "text",
                "replace": "published_date",
                "attr": ""
            }
        ],
        "xmlMode": false,
        "decodeEntities": false,
        "lowerCaseTags": false,
        "lowerCaseAttributeNames": true,
        "recognizeCDATA": false,
        "recognizeSelfClosing": false,
        "x": 600,
        "y": 100,
        "wires": [
            [
                "c29535e4bd0b786a"
            ]
        ]
    },
    {
        "id": "26eb1525168a4179",
        "type": "moment",
        "z": "229c44d5bbf84eb1",
        "name": "format pubdate",
        "topic": "",
        "input": "payload.published_date",
        "inputType": "msg",
        "inTz": "Europe/Lisbon",
        "adjAmount": 0,
        "adjType": "days",
        "adjDir": "add",
        "format": "",
        "locale": "en-US",
        "output": "payload.published_date",
        "outputType": "msg",
        "outTz": "Europe/Lisbon",
        "x": 360,
        "y": 160,
        "wires": [
            [
                "a1d01711646bda4d"
            ]
        ]
    },
    {
        "id": "52765ffb61f2f16b",
        "type": "http request",
        "z": "229c44d5bbf84eb1",
        "name": "",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://api.gregory-ms.com/articles/post/",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "other",
                "keyValue": "Authorization",
                "valueType": "other",
                "valueValue": "API KEY"
            }
        ],
        "x": 710,
        "y": 160,
        "wires": [
            [
                "3941bed5f9e4e346"
            ]
        ]
    },
    {
        "id": "a1d01711646bda4d",
        "type": "delay",
        "z": "229c44d5bbf84eb1",
        "name": "",
        "pauseType": "rate",
        "timeout": "20",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "10",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 540,
        "y": 160,
        "wires": [
            [
                "52765ffb61f2f16b"
            ]
        ]
    },
    {
        "id": "3941bed5f9e4e346",
        "type": "json",
        "z": "229c44d5bbf84eb1",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 870,
        "y": 160,
        "wires": [
            [
                "feac5db07c171304"
            ]
        ]
    },
    {
        "id": "feac5db07c171304",
        "type": "debug",
        "z": "229c44d5bbf84eb1",
        "name": "debug 38",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1070,
        "y": 180,
        "wires": []
    },
    {
        "id": "bf49889256cc6783",
        "type": "http request",
        "z": "02847583794d9f3b",
        "name": "NOVARTIS",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://www.novartis.com/clinicaltrials/recruiting-trials?title=multiple%20sclerosis",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "authType": "",
        "senderr": false,
        "x": 370,
        "y": 160,
        "wires": [
            [
                "555696bf1ae29a39"
            ]
        ]
    },
    {
        "id": "07a10d29c3b03559",
        "type": "inject",
        "z": "02847583794d9f3b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "18000",
        "crontab": "",
        "once": true,
        "onceDelay": "200",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 190,
        "y": 160,
        "wires": [
            [
                "bf49889256cc6783"
            ]
        ]
    },
    {
        "id": "c204ece5aa88ae64",
        "type": "template",
        "z": "02847583794d9f3b",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "INSERT INTO trials (discovery_date, title, summary, link, published_date, source, relevant)\n\t\tVALUES(CURRENT_TIMESTAMP, '{{payload.title}}', NULL, 'https://www.novartis.com/{{{payload.link}}}', NULL, 13, NULL)",
        "output": "str",
        "x": 920,
        "y": 160,
        "wires": [
            [
                "5374561e784d98af"
            ]
        ]
    },
    {
        "id": "5edac0505be73134",
        "type": "split",
        "z": "02847583794d9f3b",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "article.key",
        "x": 650,
        "y": 160,
        "wires": [
            [
                "033ec197e68058e0"
            ]
        ]
    },
    {
        "id": "609ad472a045a811",
        "type": "http request",
        "z": "02847583794d9f3b",
        "name": "CUF",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://www.cuf.pt/cuf-academic-center/ensaios-clinicos?combine=&unidade=&estado=All&patologia=2346&especialidade=",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "senderr": false,
        "x": 350,
        "y": 240,
        "wires": [
            [
                "287c204d9da17fa1"
            ]
        ]
    },
    {
        "id": "99d79d41714d252d",
        "type": "inject",
        "z": "02847583794d9f3b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "18000",
        "crontab": "",
        "once": true,
        "onceDelay": "42",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 190,
        "y": 240,
        "wires": [
            [
                "609ad472a045a811"
            ]
        ]
    },
    {
        "id": "be6a66a22f99b2d9",
        "type": "template",
        "z": "02847583794d9f3b",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "INSERT INTO trials (discovery_date,title,summary,link,published_date,source,relevant)\nVALUES (current_timestamp,'{{payload.title}}',NULL,'https://www.cuf.pt{{{payload.link}}}',NULL,14,NULL)",
        "output": "str",
        "x": 960,
        "y": 240,
        "wires": [
            [
                "5374561e784d98af"
            ]
        ]
    },
    {
        "id": "f10a85da491f6d72",
        "type": "split",
        "z": "02847583794d9f3b",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "article.key",
        "x": 690,
        "y": 240,
        "wires": [
            [
                "ec153ddbc09ec1a8"
            ]
        ]
    },
    {
        "id": "35ec9add27d78f73",
        "type": "comment",
        "z": "02847583794d9f3b",
        "name": "Clinical Trials",
        "info": "",
        "x": 130,
        "y": 120,
        "wires": []
    },
    {
        "id": "555696bf1ae29a39",
        "type": "cheerio",
        "z": "02847583794d9f3b",
        "name": "Novartis",
        "tag": "td.views-field",
        "ret": "object",
        "as": "single",
        "map": [
            {
                "search": "a",
                "ret": "text",
                "replace": "title",
                "attr": ""
            },
            {
                "search": "td.views-field.views-field-title>a",
                "ret": "attribute",
                "replace": "link",
                "attr": "href"
            }
        ],
        "xmlMode": false,
        "decodeEntities": false,
        "lowerCaseTags": false,
        "lowerCaseAttributeNames": true,
        "recognizeCDATA": false,
        "recognizeSelfClosing": false,
        "x": 520,
        "y": 160,
        "wires": [
            [
                "5edac0505be73134"
            ]
        ]
    },
    {
        "id": "287c204d9da17fa1",
        "type": "cheerio",
        "z": "02847583794d9f3b",
        "name": "cuf",
        "tag": "div.content",
        "ret": "object",
        "as": "single",
        "map": [
            {
                "search": ".field--name-title-text",
                "ret": "text",
                "replace": "title",
                "attr": ""
            },
            {
                "search": "a",
                "ret": "attribute",
                "replace": "link",
                "attr": "href"
            }
        ],
        "xmlMode": false,
        "decodeEntities": false,
        "lowerCaseTags": false,
        "lowerCaseAttributeNames": true,
        "recognizeCDATA": false,
        "recognizeSelfClosing": false,
        "x": 570,
        "y": 240,
        "wires": [
            [
                "f10a85da491f6d72"
            ]
        ]
    },
    {
        "id": "5374561e784d98af",
        "type": "postgres",
        "z": "02847583794d9f3b",
        "postgresdb": "857f821ab371a10e",
        "name": "",
        "output": false,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": false,
        "x": 1100,
        "y": 180,
        "wires": []
    },
    {
        "id": "033ec197e68058e0",
        "type": "switch",
        "z": "02847583794d9f3b",
        "name": "",
        "property": "payload.title",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "Multiple Sclerosis",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "multiple sclerosis",
                "vt": "str"
            },
            {
                "t": "regex",
                "v": "multiple sclerosis",
                "vt": "str",
                "case": true
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 770,
        "y": 160,
        "wires": [
            [
                "c204ece5aa88ae64"
            ],
            [
                "c204ece5aa88ae64"
            ],
            [
                "c204ece5aa88ae64"
            ]
        ]
    },
    {
        "id": "ec153ddbc09ec1a8",
        "type": "switch",
        "z": "02847583794d9f3b",
        "name": "",
        "property": "payload.title",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "Multiple Sclerosis",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "multiple sclerosis",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 810,
        "y": 240,
        "wires": [
            [
                "be6a66a22f99b2d9"
            ],
            []
        ]
    },
    {
        "id": "bdf7dcf7e77c8fb1",
        "type": "http request",
        "z": "a38a4dce4a95b8aa",
        "d": true,
        "name": "journals.sagepub",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://journals.sagepub.com/action/doSearch?AllField=multiple+sclerosis&SeriesKey=msja&content=articlesChapters&countTerms=true&target=default&sortBy=Ppub&startPage=&ContentItemType=research-article",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "authType": "",
        "senderr": false,
        "x": 350,
        "y": 80,
        "wires": [
            [
                "b10e446e32a599c1",
                "bf7261993e7a2040"
            ]
        ]
    },
    {
        "id": "357f624d0bda7d21",
        "type": "inject",
        "z": "a38a4dce4a95b8aa",
        "d": true,
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "source",
                "v": "9",
                "vt": "num"
            }
        ],
        "repeat": "86400",
        "crontab": "",
        "once": true,
        "onceDelay": "99",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 170,
        "y": 80,
        "wires": [
            [
                "bdf7dcf7e77c8fb1"
            ]
        ]
    },
    {
        "id": "b11c5b63379dd054",
        "type": "split",
        "z": "a38a4dce4a95b8aa",
        "d": true,
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "article.key",
        "x": 790,
        "y": 80,
        "wires": [
            [
                "21a6f750c3abb2a1"
            ]
        ]
    },
    {
        "id": "21a6f750c3abb2a1",
        "type": "change",
        "z": "a38a4dce4a95b8aa",
        "d": true,
        "name": "set source SagePub",
        "rules": [
            {
                "t": "set",
                "p": "article",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "article.url",
                "pt": "msg",
                "to": "\"https://journals.sagepub.com\" & payload.link",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "article.source",
                "pt": "msg",
                "to": "Sage Pub",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "article.description",
                "pt": "msg",
                "to": "not available",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "article.title",
                "pt": "msg",
                "to": "$trim(article.title)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.pubdate",
                "pt": "msg",
                "to": "$split($trim($replace(article.pubdate, \", First Published \", \" \")),\".\",1)",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 960,
        "y": 80,
        "wires": [
            [
                "a171fa7197616bce"
            ]
        ]
    },
    {
        "id": "a171fa7197616bce",
        "type": "change",
        "z": "a38a4dce4a95b8aa",
        "d": true,
        "name": "fix pubdate",
        "rules": [
            {
                "t": "set",
                "p": "payload.pubdate",
                "pt": "msg",
                "to": "$replace($replace(payload.pubdate[0],\" \", \"-\"),\",\",\"\")",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1150,
        "y": 80,
        "wires": [
            [
                "a5a10522b92c0bb6"
            ]
        ]
    },
    {
        "id": "b37b5d10ade11d4b",
        "type": "subflow:3d5c22a1ade8c013",
        "z": "a38a4dce4a95b8aa",
        "d": true,
        "name": "Insert SQL",
        "env": [],
        "x": 810,
        "y": 180,
        "wires": [
            [
                "cc064dd2df5af8ab",
                "df7d1918121d6cbf"
            ]
        ]
    },
    {
        "id": "b10e446e32a599c1",
        "type": "cheerio",
        "z": "a38a4dce4a95b8aa",
        "d": true,
        "name": "",
        "tag": ".searchResultItem",
        "ret": "object",
        "as": "single",
        "map": [
            {
                "search": "h2",
                "ret": "text",
                "replace": "title",
                "attr": ""
            },
            {
                "search": "h2>span>a",
                "ret": "attribute",
                "replace": "link",
                "attr": "href"
            },
            {
                "search": "div.hlFld-Abstract.preview-abstract",
                "ret": "text",
                "replace": "description",
                "attr": ""
            },
            {
                "search": "span.publication-meta",
                "ret": "text",
                "replace": "pubdate",
                "attr": ""
            }
        ],
        "xmlMode": false,
        "decodeEntities": false,
        "lowerCaseTags": false,
        "lowerCaseAttributeNames": true,
        "recognizeCDATA": false,
        "recognizeSelfClosing": false,
        "x": 570,
        "y": 80,
        "wires": [
            [
                "b11c5b63379dd054",
                "bf7261993e7a2040"
            ]
        ]
    },
    {
        "id": "a5a10522b92c0bb6",
        "type": "moment",
        "z": "a38a4dce4a95b8aa",
        "d": true,
        "name": "format pubdate",
        "topic": "",
        "input": "payload.pubdate",
        "inputType": "msg",
        "inTz": "Europe/Lisbon",
        "adjAmount": 0,
        "adjType": "days",
        "adjDir": "add",
        "format": "",
        "locale": "en-US",
        "output": "article.pubdate",
        "outputType": "msg",
        "outTz": "Europe/Lisbon",
        "x": 640,
        "y": 180,
        "wires": [
            [
                "b37b5d10ade11d4b"
            ]
        ]
    },
    {
        "id": "a9148801c21f3d41",
        "type": "subflow:346ec29c7e27ea2e",
        "z": "a38a4dce4a95b8aa",
        "d": true,
        "name": "",
        "x": 1450,
        "y": 300,
        "wires": [
            [
                "56f1dd10efc3af92"
            ]
        ]
    },
    {
        "id": "56f1dd10efc3af92",
        "type": "debug",
        "z": "a38a4dce4a95b8aa",
        "d": true,
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1740,
        "y": 340,
        "wires": []
    },
    {
        "id": "19d9880ce23b17d8",
        "type": "comment",
        "z": "a38a4dce4a95b8aa",
        "name": "ADD SAGEPUB SUMMARY",
        "info": "",
        "x": 200,
        "y": 240,
        "wires": []
    },
    {
        "id": "0fdf992e2a4b31c7",
        "type": "split",
        "z": "a38a4dce4a95b8aa",
        "d": true,
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 540,
        "y": 280,
        "wires": [
            [
                "2c174e0bece2c39c"
            ]
        ]
    },
    {
        "id": "934464ff05531550",
        "type": "http request",
        "z": "a38a4dce4a95b8aa",
        "d": true,
        "name": "SAGEPUB",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 860,
        "y": 320,
        "wires": [
            [
                "ad04d9fa569437b8"
            ]
        ]
    },
    {
        "id": "513f9aa2bc88dd23",
        "type": "change",
        "z": "a38a4dce4a95b8aa",
        "d": true,
        "name": "set fields",
        "rules": [
            {
                "t": "set",
                "p": "url",
                "pt": "msg",
                "to": "payload.link",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "article_id",
                "pt": "msg",
                "to": "payload.article_id",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 690,
        "y": 320,
        "wires": [
            [
                "934464ff05531550"
            ]
        ]
    },
    {
        "id": "f29328b354aedc36",
        "type": "template",
        "z": "a38a4dce4a95b8aa",
        "d": true,
        "name": "",
        "field": "topic",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "UPDATE articles\nset summary = \"{{{payload.summary}}}\"\nwhere article_id = {{article_id}};",
        "output": "str",
        "x": 1130,
        "y": 320,
        "wires": [
            [
                "a9148801c21f3d41"
            ]
        ]
    },
    {
        "id": "0bdbbe7165770dca",
        "type": "inject",
        "z": "a38a4dce4a95b8aa",
        "d": true,
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "7200",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 280,
        "wires": [
            [
                "1916487558ba2188"
            ]
        ]
    },
    {
        "id": "2c174e0bece2c39c",
        "type": "delay",
        "z": "a38a4dce4a95b8aa",
        "d": true,
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "30",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 530,
        "y": 340,
        "wires": [
            [
                "513f9aa2bc88dd23"
            ]
        ]
    },
    {
        "id": "ad04d9fa569437b8",
        "type": "cheerio",
        "z": "a38a4dce4a95b8aa",
        "d": true,
        "name": "",
        "tag": "body",
        "ret": "object",
        "as": "multi",
        "map": [
            {
                "search": "div.hlFld-Abstract",
                "ret": "text",
                "replace": "summary",
                "attr": ""
            }
        ],
        "xmlMode": false,
        "decodeEntities": false,
        "lowerCaseTags": false,
        "lowerCaseAttributeNames": false,
        "recognizeCDATA": false,
        "recognizeSelfClosing": false,
        "x": 1000,
        "y": 320,
        "wires": [
            [
                "f29328b354aedc36"
            ]
        ]
    },
    {
        "id": "1916487558ba2188",
        "type": "sqlite",
        "z": "a38a4dce4a95b8aa",
        "d": true,
        "mydb": "9ccc1658.e12858",
        "sqlquery": "fixed",
        "sql": "SELECT * FROM articles \nWHERE source = \"Sage Pub\" \nAND summary =\"not available\";",
        "name": "",
        "x": 380,
        "y": 280,
        "wires": [
            [
                "0fdf992e2a4b31c7"
            ]
        ]
    },
    {
        "id": "33f3921a91b80ed9",
        "type": "debug",
        "z": "a38a4dce4a95b8aa",
        "d": true,
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "article_id",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 800,
        "y": 700,
        "wires": []
    },
    {
        "id": "c49f486b8e6b37b2",
        "type": "sqlite",
        "z": "a38a4dce4a95b8aa",
        "d": true,
        "mydb": "9ccc1658.e12858",
        "sqlquery": "fixed",
        "sql": "select article_id,link from articles where source = \"Sage Pub\" and published_date = \"\" limit 1;",
        "name": "",
        "x": 350,
        "y": 540,
        "wires": [
            [
                "5e2944c15177ab7b"
            ]
        ]
    },
    {
        "id": "5e2944c15177ab7b",
        "type": "change",
        "z": "a38a4dce4a95b8aa",
        "d": true,
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "article_id",
                "pt": "msg",
                "to": "payload[0].article_id",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload[0].link",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "url",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 540,
        "y": 540,
        "wires": [
            [
                "0fefe071b1bb64db"
            ]
        ]
    },
    {
        "id": "e38f3f3c4b39932b",
        "type": "sqlite",
        "z": "a38a4dce4a95b8aa",
        "d": true,
        "mydb": "9ccc1658.e12858",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "",
        "x": 590,
        "y": 700,
        "wires": [
            [
                "33f3921a91b80ed9"
            ]
        ]
    },
    {
        "id": "4c63900676c67787",
        "type": "comment",
        "z": "a38a4dce4a95b8aa",
        "name": "populate missing values of published date not working",
        "info": "",
        "x": 310,
        "y": 480,
        "wires": []
    },
    {
        "id": "0fefe071b1bb64db",
        "type": "http request",
        "z": "a38a4dce4a95b8aa",
        "d": true,
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": false,
        "url": "",
        "persist": false,
        "authType": "",
        "senderr": false,
        "x": 130,
        "y": 620,
        "wires": [
            [
                "9b5e007c73488db0"
            ]
        ]
    },
    {
        "id": "9b5e007c73488db0",
        "type": "cheerio",
        "z": "a38a4dce4a95b8aa",
        "d": true,
        "name": "",
        "tag": ".publicationContentEpubDate.dates",
        "ret": "html",
        "as": "single",
        "map": [
            {
                "search": "",
                "ret": "html",
                "replace": "",
                "attr": ""
            }
        ],
        "xmlMode": false,
        "decodeEntities": false,
        "lowerCaseTags": false,
        "lowerCaseAttributeNames": false,
        "recognizeCDATA": false,
        "recognizeSelfClosing": false,
        "x": 390,
        "y": 620,
        "wires": [
            [
                "041fcb5ee56c8e57"
            ]
        ]
    },
    {
        "id": "041fcb5ee56c8e57",
        "type": "string",
        "z": "a38a4dce4a95b8aa",
        "d": true,
        "name": "",
        "methods": [
            {
                "name": "trim",
                "params": []
            },
            {
                "name": "delLeftMost",
                "params": [
                    {
                        "type": "str",
                        "value": "<b>First Published </b> "
                    }
                ]
            }
        ],
        "prop": "payload[0]",
        "propout": "payload",
        "object": "msg",
        "objectout": "msg",
        "x": 610,
        "y": 620,
        "wires": [
            [
                "eb757de17b81869f",
                "df7d1918121d6cbf"
            ]
        ]
    },
    {
        "id": "eb757de17b81869f",
        "type": "moment",
        "z": "a38a4dce4a95b8aa",
        "d": true,
        "name": "",
        "topic": "",
        "input": "payload",
        "inputType": "msg",
        "inTz": "Europe/Lisbon",
        "adjAmount": "1",
        "adjType": "days",
        "adjDir": "add",
        "format": "",
        "locale": "POSIX",
        "output": "",
        "outputType": "msg",
        "outTz": "Europe/Lisbon",
        "x": 180,
        "y": 700,
        "wires": [
            [
                "1544defd6dc58dbb"
            ]
        ]
    },
    {
        "id": "1544defd6dc58dbb",
        "type": "template",
        "z": "a38a4dce4a95b8aa",
        "d": true,
        "name": "",
        "field": "topic",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "update articles set published_date ='{{payload}}' where article_id  = {{article_id}};",
        "output": "str",
        "x": 380,
        "y": 700,
        "wires": [
            [
                "e38f3f3c4b39932b"
            ]
        ]
    },
    {
        "id": "df7d1918121d6cbf",
        "type": "debug",
        "z": "a38a4dce4a95b8aa",
        "d": true,
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 810,
        "y": 540,
        "wires": []
    },
    {
        "id": "cc064dd2df5af8ab",
        "type": "postgres",
        "z": "a38a4dce4a95b8aa",
        "d": true,
        "postgresdb": "857f821ab371a10e",
        "name": "",
        "output": false,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": false,
        "x": 1060,
        "y": 220,
        "wires": []
    },
    {
        "id": "bf7261993e7a2040",
        "type": "debug",
        "z": "a38a4dce4a95b8aa",
        "d": true,
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 460,
        "y": 200,
        "wires": []
    },
    {
        "id": "6cd3a849639ab848",
        "type": "comment",
        "z": "d37ec6d25d6bf29f",
        "name": "contentful tokens and urls",
        "info": "# token for testing in bdh\n\nPersonal Access Token: `CFPAT GOES HERE`\n\nContent Delivery API access token: `ACCESS TOKEN HERE`\n\nContent Preview API access token: `ACCESS-TOKEN-HERE`\n\n\nhttps://api.contentful.com/spaces/{space_id}/environments/{environment_id}/content_types\n\nhttps://www.contentful.com/developers/docs/references/content-management-api/#/reference/content-types/activated-content-type-collection\n\nget all envs\n\nhttps://api.contentful.com/spaces/{space_id}/environments  \n\nget all entries from space\n\nhttps://api.contentful.com/spaces/{space_id}/environments/{environment_id}/entries\n\n## Create an entry\n\ncurl --include \\\n     --request POST \\\n     --header 'Authorization: Bearer <cma_token>' \\\n     --header 'Content-Type: application/vnd.contentful.management.v1+json' \\\n     --header 'X-Contentful-Content-Type: 2PqfXUJwE8qSYKuM0U6w8M' \\\n     --data-binary '{\n       \"fields\": {\n         \"title\": {\n           \"en-US\": \"Hello, World!\"\n         },\n         \"body\": {\n           \"en-US\": \"Bacon is healthy!\"\n         }\n       },\n       \"metadata\": {\n         \"tags\": [\n           {\n             \"sys\": {\n               \"type\": \"Link\",\n               \"linkType\": \"Tag\",\n               \"id\": \"nyCampaign\"\n             }\n           }\n         ]\n       }\n     }' \\\n     https://api.contentful.com/spaces/{space_id}/environments/{environment_id}/entries",
        "x": 150,
        "y": 40,
        "wires": []
    },
    {
        "id": "4658c54b039c6d72",
        "type": "sqlite",
        "z": "d37ec6d25d6bf29f",
        "mydb": "9ccc1658.e12858",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "",
        "x": 740,
        "y": 380,
        "wires": [
            [
                "9004c39e37e5989b"
            ]
        ]
    },
    {
        "id": "7a725af2ab7f181a",
        "type": "inject",
        "z": "d37ec6d25d6bf29f",
        "d": true,
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 160,
        "y": 400,
        "wires": [
            [
                "0c177d857c800466"
            ]
        ]
    },
    {
        "id": "0c177d857c800466",
        "type": "template",
        "z": "d37ec6d25d6bf29f",
        "d": true,
        "name": "create neurodiem table",
        "field": "topic",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "--- not tested\n\nCREATE TABLE IF NOT EXISTS neurodiem (\n\tid INT PRIMARY KEY,\n   \tarticle_id INT NOT NULL,\n\tdoi INT,\n\tcontentful string DEFAULT \"queued\"\n\tauthors string DEFAULT NULL\n\tjournals string DEFAULT NULL\n\tcf_authors_ids string DEFAULT NULL\n\tcf_journals_ids string DEFAULT NULL);\n\t\n\n",
        "output": "str",
        "x": 350,
        "y": 400,
        "wires": [
            [
                "3b2ee211a0a8b13b"
            ]
        ]
    },
    {
        "id": "819616007fad18eb",
        "type": "inject",
        "z": "d37ec6d25d6bf29f",
        "name": "select count(*) from neurodiem;",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "select count(*) from neurodiem;",
        "payload": "",
        "payloadType": "date",
        "x": 190,
        "y": 320,
        "wires": [
            [
                "3b2ee211a0a8b13b"
            ]
        ]
    },
    {
        "id": "d160b81c33904661",
        "type": "postgres",
        "z": "d37ec6d25d6bf29f",
        "d": true,
        "postgresdb": "857f821ab371a10e",
        "name": "",
        "output": true,
        "perrow": true,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 380,
        "y": 620,
        "wires": [
            [
                "4e4ee4df3440e9fd"
            ]
        ]
    },
    {
        "id": "5edaa102f768c4ee",
        "type": "debug",
        "z": "d37ec6d25d6bf29f",
        "d": true,
        "name": "debug 2",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 580,
        "y": 720,
        "wires": []
    },
    {
        "id": "a414b5d5f3226ef3",
        "type": "inject",
        "z": "d37ec6d25d6bf29f",
        "d": true,
        "name": "fetch all articles from gregoryDB, insert into SQLite",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 250,
        "y": 540,
        "wires": [
            [
                "2fdf0f0f91f9c90d"
            ]
        ]
    },
    {
        "id": "2fdf0f0f91f9c90d",
        "type": "template",
        "z": "d37ec6d25d6bf29f",
        "d": true,
        "name": "get all articles",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "select article_id,doi from articles;",
        "output": "str",
        "x": 380,
        "y": 580,
        "wires": [
            [
                "d160b81c33904661"
            ]
        ]
    },
    {
        "id": "4e4ee4df3440e9fd",
        "type": "template",
        "z": "d37ec6d25d6bf29f",
        "d": true,
        "name": "insert articles into neurodiemSQLite",
        "field": "topic",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "insert into neurodiem (article_id,doi)\nvalues ({{payload.article_id}},\"{{{payload.doi}}}\");",
        "output": "str",
        "x": 300,
        "y": 680,
        "wires": [
            [
                "6e70141516bbb998"
            ]
        ]
    },
    {
        "id": "6e70141516bbb998",
        "type": "sqlite",
        "z": "d37ec6d25d6bf29f",
        "d": true,
        "mydb": "9ccc1658.e12858",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "",
        "x": 360,
        "y": 720,
        "wires": [
            [
                "5edaa102f768c4ee"
            ]
        ]
    },
    {
        "id": "57474d8e068b5d5c",
        "type": "inject",
        "z": "d37ec6d25d6bf29f",
        "name": "delete from neurodiem where article_id > 0;",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "delete from neurodiem where article_id > 0;",
        "payload": "",
        "payloadType": "date",
        "x": 210,
        "y": 360,
        "wires": [
            [
                "3b2ee211a0a8b13b"
            ]
        ]
    },
    {
        "id": "c33dfe3e5b3221e0",
        "type": "postgres",
        "z": "d37ec6d25d6bf29f",
        "g": "82e2e8495e59f259",
        "postgresdb": "857f821ab371a10e",
        "name": "",
        "output": true,
        "perrow": true,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "1",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 420,
        "y": 1000,
        "wires": [
            [
                "2063a693ffa7e65b"
            ]
        ]
    },
    {
        "id": "06c65a4b27ef2525",
        "type": "inject",
        "z": "d37ec6d25d6bf29f",
        "g": "82e2e8495e59f259",
        "name": "flow to keep databases in sync (READY)",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "3600",
        "crontab": "",
        "once": true,
        "onceDelay": "60",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 220,
        "y": 820,
        "wires": [
            [
                "4a378e9c1364675e"
            ]
        ]
    },
    {
        "id": "b5d69902238be226",
        "type": "sqlite",
        "z": "d37ec6d25d6bf29f",
        "g": "82e2e8495e59f259",
        "mydb": "9ccc1658.e12858",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "",
        "x": 360,
        "y": 880,
        "wires": [
            [
                "f9284596412a7158"
            ]
        ]
    },
    {
        "id": "4a378e9c1364675e",
        "type": "template",
        "z": "d37ec6d25d6bf29f",
        "g": "82e2e8495e59f259",
        "name": "select article_id",
        "field": "topic",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "select article_id from neurodiem order by article_id desc;",
        "output": "str",
        "x": 160,
        "y": 880,
        "wires": [
            [
                "b5d69902238be226"
            ]
        ]
    },
    {
        "id": "5c148d1c110c8280",
        "type": "template",
        "z": "d37ec6d25d6bf29f",
        "g": "82e2e8495e59f259",
        "name": "insert articles into neurodiemSQLite",
        "field": "topic",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "insert into neurodiem (article_id,doi,title,summary, authors, journal, takeaways)\nvalues ({{payload.article_id}},\"{{{payload.doi}}}\",\"{{payload.title}}\", \"{{payload.summary}}\",json('{{{payload.authors}}}'), \"{{payload.container_title}}\", \"{{payload.takeaways}}\");",
        "output": "str",
        "x": 460,
        "y": 1100,
        "wires": [
            [
                "5312a964a8391250"
            ]
        ]
    },
    {
        "id": "5312a964a8391250",
        "type": "sqlite",
        "z": "d37ec6d25d6bf29f",
        "g": "82e2e8495e59f259",
        "mydb": "9ccc1658.e12858",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "",
        "x": 800,
        "y": 1100,
        "wires": [
            [
                "c39422c120711310"
            ]
        ]
    },
    {
        "id": "0a5fab31f6197fa1",
        "type": "comment",
        "z": "d37ec6d25d6bf29f",
        "g": "82e2e8495e59f259",
        "name": "ready!",
        "info": "",
        "x": 600,
        "y": 820,
        "wires": []
    },
    {
        "id": "bd98d6175c234f61",
        "type": "switch",
        "z": "d37ec6d25d6bf29f",
        "g": "82e2e8495e59f259",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "empty"
            },
            {
                "t": "nempty"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 110,
        "y": 1000,
        "wires": [
            [
                "8315f76e2f4634be"
            ],
            [
                "84c58829eb54532c"
            ]
        ]
    },
    {
        "id": "84c58829eb54532c",
        "type": "template",
        "z": "d37ec6d25d6bf29f",
        "g": "82e2e8495e59f259",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "select \n    \"public\".\"articles\".\"article_id\" AS \"article_id\",\n\t\"public\".\"articles\".\"title\" AS \"title\",\n\t\"public\".\"articles\".\"summary\" AS \"summary\",\n\t\"public\".\"articles\".\"link\" AS \"link\",\n\t\"public\".\"articles\".\"published_date\" AS \"published_date\",\n\t\"public\".\"articles\".\"source\" AS \"source\",\n\t\"public\".\"articles\".\"relevant\" AS \"relevant\",\n\t\"public\".\"articles\".\"ml_prediction_gnb\" AS \"ml_prediction_gnb\",\n\t\"public\".\"articles\".\"ml_prediction_lr\" AS \"ml_prediction_lr\",\n\t\"public\".\"articles\".\"discovery_date\" AS \"discovery_date\",\n\t\"public\".\"articles\".\"noun_phrases\" AS \"noun_phrases\",\n\t\"public\".\"articles\".\"doi\" AS \"doi\",\n\t\"public\".\"articles\".\"access\" AS \"access\",\n\t\"public\".\"articles\".\"kind\" AS \"kind\",\n\t\"public\".\"articles\".\"publisher\" AS \"publisher\",\n\t\"public\".\"articles\".\"container_title\" AS \"container_title\",\n\tjson_agg(\"Authors\") as authors\nfrom articles\n\tLEFT JOIN \"public\".\"articles_authors\" \"Articles Authors\" ON \"public\".\"articles\".\"article_id\" = \"Articles Authors\".\"articles_id\"\n\tLEFT JOIN \"public\".\"authors\" \"Authors\" ON \"Articles Authors\".\"authors_id\" = \"Authors\".\"author_id\"\nwhere article_id not in (\n\t\t{{ #payload}}{{article_id}},{{/payload}} 0)\nand access = 'open'\nand takeaways is not null\n\t\tgroup by \"article_id\"\n\t\torder by \"article_id\" desc\n;\n\n",
        "output": "str",
        "x": 260,
        "y": 1020,
        "wires": [
            [
                "c33dfe3e5b3221e0"
            ]
        ]
    },
    {
        "id": "8315f76e2f4634be",
        "type": "template",
        "z": "d37ec6d25d6bf29f",
        "g": "82e2e8495e59f259",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "select\n\t\"public\".\"articles\".\"article_id\" AS \"article_id\",\n\t\"public\".\"articles\".\"title\" AS \"title\",\n\t\"public\".\"articles\".\"summary\" AS \"summary\",\n\t\"public\".\"articles\".\"link\" AS \"link\",\n\t\"public\".\"articles\".\"published_date\" AS \"published_date\",\n\t\"public\".\"articles\".\"source\" AS \"source\",\n\t\"public\".\"articles\".\"relevant\" AS \"relevant\",\n\t\"public\".\"articles\".\"ml_prediction_gnb\" AS \"ml_prediction_gnb\",\n\t\"public\".\"articles\".\"ml_prediction_lr\" AS \"ml_prediction_lr\",\n\t\"public\".\"articles\".\"discovery_date\" AS \"discovery_date\",\n\t\"public\".\"articles\".\"noun_phrases\" AS \"noun_phrases\",\n\t\"public\".\"articles\".\"doi\" AS \"doi\",\n\t\"public\".\"articles\".\"access\" AS \"access\",\n\t\"public\".\"articles\".\"kind\" AS \"kind\",\n\t\"public\".\"articles\".\"publisher\" AS \"publisher\",\n\t\"public\".\"articles\".\"container_title\" AS \"container_title\",\n\t\"public\".\"articles\".\"takeaways\" as \"takeaways\",\n\tjson_agg(\"Authors\") as authors\nfrom articles\n\tLEFT JOIN \"public\".\"articles_authors\" \"Articles Authors\" ON \"public\".\"articles\".\"article_id\" = \"Articles Authors\".\"articles_id\"\n\tLEFT JOIN \"public\".\"authors\" \"Authors\" ON \"Articles Authors\".\"authors_id\" = \"Authors\".\"author_id\"\nwhere article_id not in (0)\n\tand access = 'open'\n\tand takeaways is not null\n\tgroup by \"article_id\"\n\torder by \"article_id\" desc\n;",
        "output": "str",
        "x": 260,
        "y": 980,
        "wires": [
            [
                "c33dfe3e5b3221e0"
            ]
        ]
    },
    {
        "id": "f9284596412a7158",
        "type": "change",
        "z": "d37ec6d25d6bf29f",
        "g": "82e2e8495e59f259",
        "name": "",
        "rules": [
            {
                "t": "delete",
                "p": "topic",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 690,
        "y": 880,
        "wires": [
            [
                "bd98d6175c234f61"
            ]
        ]
    },
    {
        "id": "b516097a02936a11",
        "type": "template",
        "z": "d37ec6d25d6bf29f",
        "name": "add authors column",
        "field": "topic",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "ALTER TABLE neurodiem\n  ADD authors NULL;",
        "output": "str",
        "x": 480,
        "y": 240,
        "wires": [
            [
                "3b2ee211a0a8b13b"
            ]
        ]
    },
    {
        "id": "297ffe3ce6b5cad2",
        "type": "inject",
        "z": "d37ec6d25d6bf29f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 160,
        "y": 280,
        "wires": [
            [
                "d471903a4b03bbed"
            ]
        ]
    },
    {
        "id": "d471903a4b03bbed",
        "type": "template",
        "z": "d37ec6d25d6bf29f",
        "name": "query table limit 10",
        "field": "topic",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "select * from neurodiem limit 10;",
        "output": "str",
        "x": 330,
        "y": 280,
        "wires": [
            [
                "249ce247f7e25a4b"
            ]
        ]
    },
    {
        "id": "a47f5dcd651592f1",
        "type": "inject",
        "z": "d37ec6d25d6bf29f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 160,
        "y": 240,
        "wires": [
            [
                "b516097a02936a11"
            ]
        ]
    },
    {
        "id": "c39422c120711310",
        "type": "debug",
        "z": "d37ec6d25d6bf29f",
        "g": "82e2e8495e59f259",
        "name": "debug 6",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 840,
        "y": 980,
        "wires": []
    },
    {
        "id": "2063a693ffa7e65b",
        "type": "json",
        "z": "d37ec6d25d6bf29f",
        "g": "82e2e8495e59f259",
        "name": "",
        "property": "payload.authors",
        "action": "str",
        "pretty": false,
        "x": 110,
        "y": 1100,
        "wires": [
            [
                "56952e14b1c2b837"
            ]
        ]
    },
    {
        "id": "30e7b73f08fed382",
        "type": "inject",
        "z": "d37ec6d25d6bf29f",
        "name": "pragma table_info('neurodiem');",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "pragma table_info('neurodiem');",
        "payload": "",
        "payloadType": "date",
        "x": 270,
        "y": 460,
        "wires": [
            [
                "3b2ee211a0a8b13b"
            ]
        ]
    },
    {
        "id": "30f9edab65c16c4e",
        "type": "inject",
        "z": "d37ec6d25d6bf29f",
        "name": "select takeaways from neurodiem;",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "select takeaways from neurodiem;",
        "payload": "",
        "payloadType": "date",
        "x": 280,
        "y": 500,
        "wires": [
            [
                "3b2ee211a0a8b13b"
            ]
        ]
    },
    {
        "id": "56952e14b1c2b837",
        "type": "string",
        "z": "d37ec6d25d6bf29f",
        "g": "82e2e8495e59f259",
        "name": "",
        "methods": [
            {
                "name": "replaceAll",
                "params": [
                    {
                        "type": "str",
                        "value": "'"
                    },
                    {
                        "type": "str",
                        "value": "''"
                    }
                ]
            }
        ],
        "prop": "payload.authors",
        "propout": "payload.authors",
        "object": "msg",
        "objectout": "msg",
        "x": 230,
        "y": 1100,
        "wires": [
            [
                "5c148d1c110c8280"
            ]
        ]
    },
    {
        "id": "249ce247f7e25a4b",
        "type": "json",
        "z": "d37ec6d25d6bf29f",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 490,
        "y": 280,
        "wires": [
            [
                "3b2ee211a0a8b13b"
            ]
        ]
    },
    {
        "id": "efdc3ddbb2c71ea2",
        "type": "template",
        "z": "d37ec6d25d6bf29f",
        "name": "add cf_authors_ids column",
        "field": "topic",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "ALTER TABLE neurodiem\n  ADD cf_authors_ids NULL;",
        "output": "str",
        "x": 500,
        "y": 200,
        "wires": [
            [
                "4658c54b039c6d72"
            ]
        ]
    },
    {
        "id": "514aa194d736e4bb",
        "type": "inject",
        "z": "d37ec6d25d6bf29f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 180,
        "y": 200,
        "wires": [
            [
                "efdc3ddbb2c71ea2"
            ]
        ]
    },
    {
        "id": "3e34960fca98e040",
        "type": "inject",
        "z": "d37ec6d25d6bf29f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "update neurodiem set cf_authors_ids = NULL where cf_authors_ids = '[\"\"]';",
        "payload": "",
        "payloadType": "date",
        "x": 790,
        "y": 240,
        "wires": [
            [
                "4658c54b039c6d72"
            ]
        ]
    },
    {
        "id": "f3e678a21779f057",
        "type": "template",
        "z": "d37ec6d25d6bf29f",
        "name": "add journal column",
        "field": "topic",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "ALTER TABLE neurodiem\n  ADD mla NULL;\n  \nALTER TABLE neurodiem\n  ADD apa NULL;\n  \nALTER TABLE neurodiem\n  ADD journal NULL;\n  \nALTER TABLE neurodiem\n  ADD cf_journals_ids NULL;",
        "output": "str",
        "x": 470,
        "y": 140,
        "wires": [
            [
                "4658c54b039c6d72"
            ]
        ]
    },
    {
        "id": "e1963c858958df39",
        "type": "inject",
        "z": "d37ec6d25d6bf29f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 160,
        "y": 140,
        "wires": [
            [
                "f3e678a21779f057"
            ]
        ]
    },
    {
        "id": "9004c39e37e5989b",
        "type": "debug",
        "z": "d37ec6d25d6bf29f",
        "name": "debug 1",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 720,
        "y": 460,
        "wires": []
    },
    {
        "id": "bdccd510aaf2cd68",
        "type": "template",
        "z": "d37ec6d25d6bf29f",
        "name": "add columns",
        "field": "topic",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "ALTER TABLE neurodiem\n  ADD summary NULL;",
        "output": "str",
        "x": 470,
        "y": 100,
        "wires": [
            [
                "4658c54b039c6d72"
            ]
        ]
    },
    {
        "id": "8505dc23d85865e1",
        "type": "inject",
        "z": "d37ec6d25d6bf29f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 160,
        "y": 100,
        "wires": [
            [
                "bdccd510aaf2cd68"
            ]
        ]
    },
    {
        "id": "c476415b471abeec",
        "type": "http request",
        "z": "9dadc9b81f97dbb3",
        "name": "",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "bearer",
        "senderr": false,
        "headers": [
            {
                "keyType": "other",
                "keyValue": "Content-Type",
                "valueType": "other",
                "valueValue": "application/vnd.contentful.management.v1+json"
            },
            {
                "keyType": "other",
                "keyValue": "X-Contentful-Content-Type",
                "valueType": "other",
                "valueValue": "journal"
            }
        ],
        "x": 470,
        "y": 340,
        "wires": [
            [
                "af507f23db0743ee",
                "52fecbc9610ec084"
            ]
        ]
    },
    {
        "id": "de1725de4172b28c",
        "type": "inject",
        "z": "9dadc9b81f97dbb3",
        "name": "get jornal matching title",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 160,
        "y": 220,
        "wires": [
            [
                "bddd6959fae46185"
            ]
        ]
    },
    {
        "id": "de1afa6ee0db26af",
        "type": "sqlite",
        "z": "9dadc9b81f97dbb3",
        "mydb": "9ccc1658.e12858",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "",
        "x": 520,
        "y": 280,
        "wires": [
            [
                "2492fc79a9cfcef8"
            ]
        ]
    },
    {
        "id": "bddd6959fae46185",
        "type": "template",
        "z": "9dadc9b81f97dbb3",
        "name": "get articles where cf_journals_ids is null",
        "field": "topic",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "select article_id,journal\nfrom neurodiem\nwhere cf_journals_ids is null and journal is not null\nor cf_journals_ids = \"\"\n-- where article_id = 1067000\norder by article_id desc\nlimit 1;",
        "output": "str",
        "x": 220,
        "y": 280,
        "wires": [
            [
                "de1afa6ee0db26af"
            ]
        ]
    },
    {
        "id": "2492fc79a9cfcef8",
        "type": "split",
        "z": "9dadc9b81f97dbb3",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 690,
        "y": 280,
        "wires": [
            [
                "9a65216e73018fd3"
            ]
        ]
    },
    {
        "id": "af507f23db0743ee",
        "type": "switch",
        "z": "9dadc9b81f97dbb3",
        "name": "if payload.total = 0 create",
        "property": "payload.total",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 3,
        "x": 190,
        "y": 440,
        "wires": [
            [
                "2f69d74f5414ecfc",
                "52fecbc9610ec084"
            ],
            [
                "ae478039e31916b4",
                "52fecbc9610ec084"
            ],
            [
                "52fecbc9610ec084"
            ]
        ]
    },
    {
        "id": "ae478039e31916b4",
        "type": "template",
        "z": "9dadc9b81f97dbb3",
        "name": "send to contentFul",
        "field": "payload",
        "fieldType": "msg",
        "format": "json",
        "syntax": "mustache",
        "template": "{\n  \"fields\": {\n    \"title\" : { \"en-US\": \"{{journal}}\"},\n    \"slug\": {\"en-US\": \"{{slug}}\" }\n  }\n}\n",
        "output": "json",
        "x": 430,
        "y": 460,
        "wires": [
            [
                "0f7598bfb74d16b8"
            ]
        ]
    },
    {
        "id": "0f7598bfb74d16b8",
        "type": "http request",
        "z": "9dadc9b81f97dbb3",
        "name": "",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "body",
        "url": "https://cdn.contentful.com/spaces/80kbt2ff73ne/environments/uat/entries/sf98ibibs",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "bearer",
        "senderr": false,
        "headers": [
            {
                "keyType": "other",
                "keyValue": "Content-Type",
                "valueType": "other",
                "valueValue": "application/vnd.contentful.management.v1+json"
            },
            {
                "keyType": "other",
                "keyValue": "X-Contentful-Content-Type",
                "valueType": "other",
                "valueValue": "journal"
            }
        ],
        "x": 610,
        "y": 460,
        "wires": [
            [
                "dfd75f75dcf6eb11",
                "52fecbc9610ec084"
            ]
        ]
    },
    {
        "id": "2f69d74f5414ecfc",
        "type": "join",
        "z": "9dadc9b81f97dbb3",
        "name": "",
        "mode": "auto",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": true,
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 830,
        "y": 420,
        "wires": [
            [
                "90410c3c81582aa9"
            ]
        ]
    },
    {
        "id": "90410c3c81582aa9",
        "type": "template",
        "z": "9dadc9b81f97dbb3",
        "name": "",
        "field": "topic",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "update neurodiem \nset cf_journals_ids = \"{{#payload}}{{#items}}{{sys.id}}{{/items}}{{/payload}}\"\nwhere article_id = {{article_id}};",
        "output": "str",
        "x": 940,
        "y": 520,
        "wires": [
            [
                "c7767b74b801e85e"
            ]
        ]
    },
    {
        "id": "c7767b74b801e85e",
        "type": "sqlite",
        "z": "9dadc9b81f97dbb3",
        "mydb": "9ccc1658.e12858",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "",
        "x": 980,
        "y": 560,
        "wires": [
            []
        ]
    },
    {
        "id": "dfd75f75dcf6eb11",
        "type": "change",
        "z": "9dadc9b81f97dbb3",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.items.sys.id",
                "pt": "msg",
                "to": "payload.sys.id",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 620,
        "y": 520,
        "wires": [
            [
                "2f69d74f5414ecfc"
            ]
        ]
    },
    {
        "id": "9a65216e73018fd3",
        "type": "function",
        "z": "9dadc9b81f97dbb3",
        "name": "build slug field + compose contentFul url",
        "func": "function slugify (str) {\n  str = str.replace(/^\\s+|\\s+$/g, ''); // trim\n  str = str.toLowerCase();\n\n  // remove accents, swap  for n, etc\n  var from = \"/_,:;\";\n  var to   = \"aaaaaeeeeiiiioooouuuunc------\";\n\n  for (var i=0, l=from.length ; i<l ; i++) {\n    str = str.replace(new RegExp(from.charAt(i), 'g'), to.charAt(i));\n  }\n\n  str = str.replace(/[^a-z0-9 -]/g, '') // remove invalid chars\n    .replace(/\\s+/g, '-') // collapse whitespace and replace by -\n    .replace(/-+/g, '-'); // collapse dashes\n\n  return str;\n}\n\nmsg.article_id = msg.payload.article_id;\nmsg.journal = msg.payload.journal\nmsg.payload.slug = slugify(msg.journal)\nmsg.slug = msg.payload.slug\n\nmsg.url = 'https://cdn.contentful.com/spaces/80kbt2ff73ne/environments/uat/entries/?content_type=journal&fields.title=' + msg.journal  ;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 220,
        "y": 340,
        "wires": [
            [
                "c476415b471abeec"
            ]
        ]
    },
    {
        "id": "52fecbc9610ec084",
        "type": "debug",
        "z": "9dadc9b81f97dbb3",
        "name": "debug 23",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 350,
        "y": 640,
        "wires": []
    },
    {
        "id": "1fad4ffedd408843",
        "type": "inject",
        "z": "09606ddc1e1202f9",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "3600",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 160,
        "wires": [
            [
                "acfe8f7f91cb5318"
            ]
        ]
    },
    {
        "id": "acfe8f7f91cb5318",
        "type": "template",
        "z": "09606ddc1e1202f9",
        "name": "",
        "field": "topic",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "select * from neurodiem where mla is NULL limit 500;",
        "output": "str",
        "x": 440,
        "y": 160,
        "wires": [
            [
                "4a0ed06a0017b765"
            ]
        ]
    },
    {
        "id": "4a0ed06a0017b765",
        "type": "sqlite",
        "z": "09606ddc1e1202f9",
        "mydb": "9ccc1658.e12858",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "",
        "x": 640,
        "y": 160,
        "wires": [
            [
                "ebc2cb854edbfed6",
                "c6342bf43803bf66"
            ]
        ]
    },
    {
        "id": "c6342bf43803bf66",
        "type": "debug",
        "z": "09606ddc1e1202f9",
        "d": true,
        "name": "debug 8",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1100,
        "y": 200,
        "wires": []
    },
    {
        "id": "ebc2cb854edbfed6",
        "type": "split",
        "z": "09606ddc1e1202f9",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 290,
        "y": 220,
        "wires": [
            [
                "b843a3a01863bdd6"
            ]
        ]
    },
    {
        "id": "cf3111ef47769730",
        "type": "http request",
        "z": "09606ddc1e1202f9",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "other",
                "keyValue": "Accept",
                "valueType": "other",
                "valueValue": "text/x-bibliography; style=mla"
            }
        ],
        "x": 790,
        "y": 220,
        "wires": [
            [
                "98259bc34488e16f"
            ]
        ]
    },
    {
        "id": "b843a3a01863bdd6",
        "type": "change",
        "z": "09606ddc1e1202f9",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "url",
                "pt": "msg",
                "to": "'https://doi.org/' & payload.doi",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "article_id",
                "pt": "msg",
                "to": "payload.article_id",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 440,
        "y": 220,
        "wires": [
            [
                "b4d3afbceb268e1a"
            ]
        ]
    },
    {
        "id": "98259bc34488e16f",
        "type": "template",
        "z": "09606ddc1e1202f9",
        "name": "",
        "field": "topic",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "update neurodiem set mla = \"{{payload}}\" where article_id = {{article_id}};",
        "output": "str",
        "x": 280,
        "y": 300,
        "wires": [
            [
                "d978bde71d83587c"
            ]
        ]
    },
    {
        "id": "d978bde71d83587c",
        "type": "sqlite",
        "z": "09606ddc1e1202f9",
        "mydb": "9ccc1658.e12858",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "",
        "x": 480,
        "y": 300,
        "wires": [
            [
                "c6342bf43803bf66"
            ]
        ]
    },
    {
        "id": "b4d3afbceb268e1a",
        "type": "delay",
        "z": "09606ddc1e1202f9",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 630,
        "y": 220,
        "wires": [
            [
                "cf3111ef47769730"
            ]
        ]
    },
    {
        "id": "90b33c1b57bcd3d8",
        "type": "http request",
        "z": "78a748492c9e884f",
        "name": "",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "other",
                "keyValue": "Content-Type",
                "valueType": "other",
                "valueValue": "application/vnd.contentful.management.v1+json"
            },
            {
                "keyType": "other",
                "keyValue": "X-Contentful-Content-Type",
                "valueType": "other",
                "valueValue": "fal-gregory-ai"
            }
        ],
        "x": 750,
        "y": 240,
        "wires": [
            [
                "4e805d376e6fc81c",
                "a249af0265f36272"
            ]
        ]
    },
    {
        "id": "d9b556bc6212b5fa",
        "type": "inject",
        "z": "78a748492c9e884f",
        "name": "get author matching first name and last name",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 250,
        "y": 80,
        "wires": [
            [
                "cf58961fb6d8fbe9"
            ]
        ]
    },
    {
        "id": "6a31a84a51666bc0",
        "type": "sqlite",
        "z": "78a748492c9e884f",
        "mydb": "9ccc1658.e12858",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "",
        "x": 200,
        "y": 180,
        "wires": [
            [
                "ccd17d355bdb3d58"
            ]
        ]
    },
    {
        "id": "902aba99106cfaed",
        "type": "change",
        "z": "78a748492c9e884f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "url",
                "pt": "msg",
                "to": "'https://api.contentful.com/spaces/80kbt2ff73ne/environments/uat/entries/?access_token=ACCESS-TOKEN-HERE&content_type=paperAuthor&fields.firstName[match]=\"' &\t payload.given_name & '\"&fields.lastName[match]=\"' & payload.family_name & '\"'",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 410,
        "y": 240,
        "wires": [
            [
                "2cc2314dbd8d1e28"
            ]
        ]
    },
    {
        "id": "cf58961fb6d8fbe9",
        "type": "template",
        "z": "78a748492c9e884f",
        "name": "get articles where cf_authors_ids is null",
        "field": "topic",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "select article_id,\n\tauthors\nfrom neurodiem\nwhere cf_authors_ids is null\nor cf_authors_ids = '[\"\"]'\norder by article_id desc\nlimit 1;",
        "output": "str",
        "x": 380,
        "y": 140,
        "wires": [
            [
                "6a31a84a51666bc0"
            ]
        ]
    },
    {
        "id": "ccd17d355bdb3d58",
        "type": "json",
        "z": "78a748492c9e884f",
        "name": "",
        "property": "payload[0].authors",
        "action": "obj",
        "pretty": false,
        "x": 370,
        "y": 180,
        "wires": [
            [
                "5d675d2fac925c10",
                "a249af0265f36272"
            ]
        ]
    },
    {
        "id": "a91445ee18f5ccf9",
        "type": "change",
        "z": "78a748492c9e884f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "article_id",
                "pt": "msg",
                "to": "payload.article_id",
                "tot": "msg"
            },
            {
                "t": "delete",
                "p": "payload.article_id",
                "pt": "msg"
            },
            {
                "t": "move",
                "p": "payload.authors",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 740,
        "y": 180,
        "wires": [
            [
                "aa215a7b4d4b1a6d"
            ]
        ]
    },
    {
        "id": "5d675d2fac925c10",
        "type": "split",
        "z": "78a748492c9e884f",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 570,
        "y": 180,
        "wires": [
            [
                "a91445ee18f5ccf9"
            ]
        ]
    },
    {
        "id": "aa215a7b4d4b1a6d",
        "type": "split",
        "z": "78a748492c9e884f",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 890,
        "y": 180,
        "wires": [
            [
                "5ae4d638cd70e726"
            ]
        ]
    },
    {
        "id": "2cc2314dbd8d1e28",
        "type": "delay",
        "z": "78a748492c9e884f",
        "name": "",
        "pauseType": "rate",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "3",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 590,
        "y": 240,
        "wires": [
            [
                "90b33c1b57bcd3d8"
            ]
        ]
    },
    {
        "id": "a249af0265f36272",
        "type": "debug",
        "z": "78a748492c9e884f",
        "name": "save in database",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1290,
        "y": 80,
        "wires": []
    },
    {
        "id": "4e805d376e6fc81c",
        "type": "switch",
        "z": "78a748492c9e884f",
        "name": "",
        "property": "payload.items",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "empty"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 230,
        "y": 320,
        "wires": [
            [
                "35a7afa7be7c9e8a"
            ],
            [
                "08b8a2137080be07"
            ]
        ]
    },
    {
        "id": "5ae4d638cd70e726",
        "type": "change",
        "z": "78a748492c9e884f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "author.given_name",
                "pt": "msg",
                "to": "payload.given_name",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "author.family_name",
                "pt": "msg",
                "to": "payload.family_name",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1060,
        "y": 180,
        "wires": [
            [
                "902aba99106cfaed"
            ]
        ]
    },
    {
        "id": "08b8a2137080be07",
        "type": "template",
        "z": "78a748492c9e884f",
        "name": "send to contentFul",
        "field": "payload",
        "fieldType": "msg",
        "format": "json",
        "syntax": "mustache",
        "template": "{\n  \"fields\": {\n    \"firstName\" : { \"en-US\": \"{{author.given_name}}\"},\n    \"lastName\" : { \"en-US\": \"{{author.family_name}}\"},\n    \"displayName\": {\"en-US\": \"{{author.given_name}} {{author.family_name}}\"}\n  }\n}\n",
        "output": "json",
        "x": 430,
        "y": 340,
        "wires": [
            [
                "bc8c0d68ac321cfe"
            ]
        ]
    },
    {
        "id": "bc8c0d68ac321cfe",
        "type": "http request",
        "z": "78a748492c9e884f",
        "name": "",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "body",
        "url": "",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "bearer",
        "senderr": false,
        "headers": [
            {
                "keyType": "other",
                "keyValue": "Content-Type",
                "valueType": "other",
                "valueValue": "application/vnd.contentful.management.v1+json"
            },
            {
                "keyType": "other",
                "keyValue": "X-Contentful-Content-Type",
                "valueType": "other",
                "valueValue": "paperAuthor"
            }
        ],
        "x": 410,
        "y": 400,
        "wires": [
            [
                "c4bd9f0b943d2325"
            ]
        ]
    },
    {
        "id": "35a7afa7be7c9e8a",
        "type": "join",
        "z": "78a748492c9e884f",
        "name": "",
        "mode": "auto",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": true,
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 810,
        "y": 320,
        "wires": [
            [
                "989bad792cd7070d"
            ]
        ]
    },
    {
        "id": "989bad792cd7070d",
        "type": "template",
        "z": "78a748492c9e884f",
        "name": "",
        "field": "topic",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "\n\nupdate neurodiem set cf_authors_ids = json('[{{#payload}}{{#items}}\"{{sys.id}}\",{{/items}}{{/payload}}\"\"]')\nwhere article_id = {{article_id}};",
        "output": "str",
        "x": 940,
        "y": 320,
        "wires": [
            [
                "6708658b975db308"
            ]
        ]
    },
    {
        "id": "867513e8900a6c26",
        "type": "sqlite",
        "z": "78a748492c9e884f",
        "mydb": "9ccc1658.e12858",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "",
        "x": 1120,
        "y": 380,
        "wires": [
            [
                "a249af0265f36272"
            ]
        ]
    },
    {
        "id": "c4bd9f0b943d2325",
        "type": "change",
        "z": "78a748492c9e884f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.items.sys.id",
                "pt": "msg",
                "to": "payload.sys.id",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 620,
        "y": 400,
        "wires": [
            [
                "35a7afa7be7c9e8a"
            ]
        ]
    },
    {
        "id": "6708658b975db308",
        "type": "string",
        "z": "78a748492c9e884f",
        "name": "clean up output",
        "methods": [
            {
                "name": "replaceAll",
                "params": [
                    {
                        "type": "str",
                        "value": ",\"\""
                    },
                    {
                        "type": "str",
                        "value": ""
                    }
                ]
            }
        ],
        "prop": "topic",
        "propout": "topic",
        "object": "msg",
        "objectout": "msg",
        "x": 1100,
        "y": 320,
        "wires": [
            [
                "867513e8900a6c26",
                "a249af0265f36272"
            ]
        ]
    },
    {
        "id": "fc4c5d9812c84b15",
        "type": "inject",
        "z": "78a748492c9e884f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "update neurodiem set contentful = \"queued\" where article_id = 1059257;",
        "payload": "",
        "payloadType": "date",
        "x": 370,
        "y": 680,
        "wires": [
            [
                "867513e8900a6c26"
            ]
        ]
    },
    {
        "id": "ddf95f9811b5421c",
        "type": "inject",
        "z": "78a748492c9e884f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "select * from neurodiem where article_id = 1059257;",
        "payload": "",
        "payloadType": "date",
        "x": 400,
        "y": 560,
        "wires": [
            [
                "867513e8900a6c26"
            ]
        ]
    },
    {
        "id": "cdb90cb07240ab67",
        "type": "inject",
        "z": "d7f4697ea11dc8c3",
        "name": "get spaces",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "token",
                "v": "CFPAT-mt14maqWh3jYA9uC58-xgrZs4sIoF9y48KcbIBBzER8",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 360,
        "y": 60,
        "wires": [
            [
                "4438ec6eb053d8e1"
            ]
        ]
    },
    {
        "id": "4438ec6eb053d8e1",
        "type": "http request",
        "z": "d7f4697ea11dc8c3",
        "name": "",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "https://api.contentful.com/spaces",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "bearer",
        "senderr": false,
        "headers": [],
        "x": 510,
        "y": 60,
        "wires": [
            [
                "42a5c5ed599ef311"
            ]
        ]
    },
    {
        "id": "55c2468c3bf0cd9e",
        "type": "http request",
        "z": "d7f4697ea11dc8c3",
        "name": "",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "https://api.contentful.com/spaces/80kbt2ff73ne/environments/uat/content_types",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "bearer",
        "senderr": false,
        "headers": [
            {
                "keyType": "other",
                "keyValue": "",
                "valueType": "other",
                "valueValue": "fal-gregory-ai"
            }
        ],
        "x": 510,
        "y": 120,
        "wires": [
            [
                "42a5c5ed599ef311"
            ]
        ]
    },
    {
        "id": "c40c9623b36a711c",
        "type": "inject",
        "z": "d7f4697ea11dc8c3",
        "name": "get content models and fields",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "token",
                "v": "CFPAT-mt14maqWh3jYA9uC58-xgrZs4sIoF9y48KcbIBBzER8",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 300,
        "y": 120,
        "wires": [
            [
                "55c2468c3bf0cd9e"
            ]
        ]
    },
    {
        "id": "2a26c7481924e335",
        "type": "inject",
        "z": "d7f4697ea11dc8c3",
        "name": "create entry",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "token",
                "v": "CFPAT-mt14maqWh3jYA9uC58-xgrZs4sIoF9y48KcbIBBzER8",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 330,
        "y": 220,
        "wires": [
            [
                "9eeaabd80dd6eef1"
            ]
        ]
    },
    {
        "id": "39ed16ade9d32ea5",
        "type": "http request",
        "z": "d7f4697ea11dc8c3",
        "name": "",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "body",
        "url": "https://api.contentful.com/spaces/80kbt2ff73ne/environments/uat/entries ",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "bearer",
        "senderr": false,
        "headers": [
            {
                "keyType": "other",
                "keyValue": "Content-Type",
                "valueType": "other",
                "valueValue": "application/vnd.contentful.management.v1+json"
            },
            {
                "keyType": "other",
                "keyValue": "X-Contentful-Content-Type",
                "valueType": "other",
                "valueValue": "blogPost"
            }
        ],
        "x": 650,
        "y": 220,
        "wires": [
            [
                "42a5c5ed599ef311"
            ]
        ]
    },
    {
        "id": "9eeaabd80dd6eef1",
        "type": "template",
        "z": "d7f4697ea11dc8c3",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "json",
        "syntax": "mustache",
        "template": "{\n\t\"fields\": {\n\t\t\"title\": {\n\t\t\t\"en-US\": \"Hello, World! My name is Gregory.\"\n\t\t},\n\t\t\"date\": {\n\t\t\t\"en-US\": \"2022-10-05T00:00+01:00\"\n\t\t}\n\t}\n}",
        "output": "str",
        "x": 500,
        "y": 220,
        "wires": [
            [
                "39ed16ade9d32ea5"
            ]
        ]
    },
    {
        "id": "0ab24aadb577fda3",
        "type": "inject",
        "z": "d7f4697ea11dc8c3",
        "name": "get entries matching content type fal-gregory-ai",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 220,
        "y": 160,
        "wires": [
            [
                "996c3bcb1b206e3b"
            ]
        ]
    },
    {
        "id": "996c3bcb1b206e3b",
        "type": "http request",
        "z": "d7f4697ea11dc8c3",
        "name": "",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "https://api.contentful.com/spaces/80kbt2ff73ne/environments/uat/entries/?content_type=fal-gregory-ai",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "bearer",
        "senderr": false,
        "headers": [
            {
                "keyType": "other",
                "keyValue": "Content-Type",
                "valueType": "other",
                "valueValue": "application/vnd.contentful.management.v1+json"
            },
            {
                "keyType": "other",
                "keyValue": "X-Contentful-Content-Type",
                "valueType": "other",
                "valueValue": "fal-gregory-ai"
            }
        ],
        "x": 510,
        "y": 160,
        "wires": [
            [
                "42a5c5ed599ef311"
            ]
        ]
    },
    {
        "id": "9cf795be84ae181a",
        "type": "inject",
        "z": "d7f4697ea11dc8c3",
        "name": "get new articles from sqlite",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 170,
        "y": 500,
        "wires": [
            [
                "75e7d616c80eae81"
            ]
        ]
    },
    {
        "id": "fde73003e33388ac",
        "type": "template",
        "z": "d7f4697ea11dc8c3",
        "name": "update sqlite database with success ",
        "field": "topic",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "UPDATE\n\tneurodiem\nSET\n\tcontentful = 'success'\nWHERE\n\tarticle_id = {{article_id}}",
        "output": "str",
        "x": 490,
        "y": 800,
        "wires": [
            [
                "97130af035ede07b"
            ]
        ]
    },
    {
        "id": "75e7d616c80eae81",
        "type": "template",
        "z": "d7f4697ea11dc8c3",
        "name": "select new batch from neurodiemSQLite",
        "field": "topic",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "select *\nfrom neurodiem\nwhere contentful = 'queued'\nand cf_authors_ids is not null\nand cf_journals_ids is not null\nand cf_authors_ids != '[\"\"]'\nand mla is not null\nand takeaways is not null\norder by article_id desc\nlimit 1;",
        "output": "str",
        "x": 220,
        "y": 540,
        "wires": [
            [
                "b81d7080b085a1cb"
            ]
        ]
    },
    {
        "id": "b81d7080b085a1cb",
        "type": "sqlite",
        "z": "d7f4697ea11dc8c3",
        "mydb": "9ccc1658.e12858",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "",
        "x": 160,
        "y": 580,
        "wires": [
            [
                "ba7c49b99c1f4107",
                "a160f3ed81797456"
            ]
        ]
    },
    {
        "id": "a160f3ed81797456",
        "type": "debug",
        "z": "d7f4697ea11dc8c3",
        "name": "debug 5",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1160,
        "y": 700,
        "wires": []
    },
    {
        "id": "f2092ba6b617d502",
        "type": "delay",
        "z": "d7f4697ea11dc8c3",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 150,
        "y": 640,
        "wires": [
            []
        ]
    },
    {
        "id": "b34382ebf6d87801",
        "type": "http request",
        "z": "d7f4697ea11dc8c3",
        "name": "",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "body",
        "url": "https://api.contentful.com/spaces/80kbt2ff73ne/environments/uat/entries ",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "bearer",
        "senderr": false,
        "headers": [
            {
                "keyType": "other",
                "keyValue": "Content-Type",
                "valueType": "other",
                "valueValue": "application/vnd.contentful.management.v1+json"
            },
            {
                "keyType": "other",
                "keyValue": "X-Contentful-Content-Type",
                "valueType": "other",
                "valueValue": "gregoryFeaturedArticle"
            }
        ],
        "x": 430,
        "y": 740,
        "wires": [
            [
                "f73bcb2c5b9d20b9"
            ]
        ]
    },
    {
        "id": "f73bcb2c5b9d20b9",
        "type": "switch",
        "z": "d7f4697ea11dc8c3",
        "name": "",
        "property": "statusCode",
        "propertyType": "msg",
        "rules": [
            {
                "t": "else"
            },
            {
                "t": "eq",
                "v": "201",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 590,
        "y": 740,
        "wires": [
            [
                "a160f3ed81797456"
            ],
            [
                "fde73003e33388ac"
            ]
        ]
    },
    {
        "id": "97130af035ede07b",
        "type": "sqlite",
        "z": "d7f4697ea11dc8c3",
        "mydb": "9ccc1658.e12858",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "",
        "x": 760,
        "y": 800,
        "wires": [
            [
                "a160f3ed81797456"
            ]
        ]
    },
    {
        "id": "42a5c5ed599ef311",
        "type": "debug",
        "z": "d7f4697ea11dc8c3",
        "name": "debug 4",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 900,
        "y": 220,
        "wires": []
    },
    {
        "id": "495b4518efb637c8",
        "type": "json",
        "z": "d7f4697ea11dc8c3",
        "name": "",
        "property": "payload.cf_authors_ids",
        "action": "",
        "pretty": true,
        "x": 750,
        "y": 580,
        "wires": [
            [
                "853e4fe318403293"
            ]
        ]
    },
    {
        "id": "847bb1232a6ea309",
        "type": "change",
        "z": "d7f4697ea11dc8c3",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "cf_authors_ids",
                "pt": "msg",
                "to": "payload.cf_authors_ids",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "cf_journals_ids",
                "pt": "msg",
                "to": "payload.cf_journals_ids",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "mla",
                "pt": "msg",
                "to": "payload.mla",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "takeaways",
                "pt": "msg",
                "to": "payload.takeaways",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1240,
        "y": 580,
        "wires": [
            [
                "f2092ba6b617d502"
            ]
        ]
    },
    {
        "id": "920114e46cb9cec5",
        "type": "function",
        "z": "d7f4697ea11dc8c3",
        "name": "generate contentful payload",
        "func": "payload = msg.payload\nmsg.article_id = payload.article_id\npayload.link = payload.link.substring(0,254)\n// replace jats tags with proper html\npayload.summary = payload.summary.replaceAll('jats:title','strong')\npayload.summary = payload.summary.replaceAll('jats:p','p')\nmsg.published_date = payload.published_date\nmsg.mla = msg.mla.substring(0,254)\n\n\nlet freeFullText;\nif (payload.access === 'open'){\n    freeFullText = true\n}else{\n    freeFullText = false\n}\n\nmsg.contentful = {\n  \"fields\": {\n    \"title\" : { \"en-US\": payload.title},\n    \"originalTitle\" : { \"en-US\": payload.title },\n    \"originalPublicationDate\": {\"en-US\": payload.published_date },\t\n    \"jsonContent\" : { \"en-US\": { \"value\": payload.summary  }},\n    \"linkToAbstract\" : { \"en-US\": 'https://doi.org/' + payload.doi },\n    \"linkToFullText\" : { \"en-US\": 'https://doi.org/' + payload.doi },\n    \"freeFullText\": { \"en-US\": freeFullText},\n    \"paperReference\": {\"en-US\": msg.mla },\n    //\"slug\" : { \"en-US\": payload.link }, // removing because it is generated automatically\n    //\"authors\" : { \"en-US\": payload.authors },\n    \"doi\":{ \"en-US\": payload.doi },\n    \"provider\": {\"en-US\":{\"sys\":{\"type\":\"Link\",\"linkType\":\"Entry\",\"id\":\"i4ONYKLOXCJh3hSyLHKSb\"}}},\n    \"journal\": {\"en-US\":{\"sys\":{\"type\":\"Link\",\"linkType\":\"Entry\",\"id\": msg.cf_journals_ids}}},\n    \"takeaways\" : { \"en-US\": msg.takeaways},\n    }\n}\n\nlet i = 0;\n\npaperAuthorSelector = []\nwhile (i < msg.cf_authors_ids.length ){\n  paperAuthorSelector.push({\"sys\":{\"type\":\"Link\",\"linkType\": \"Entry\", \"id\": msg.cf_authors_ids[i]} })\ni++;\n}\nmsg.contentful.fields.paperAuthorSelector = { \"en-US\": paperAuthorSelector}\nmsg.payload = msg.contentful;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 220,
        "y": 740,
        "wires": [
            [
                "b34382ebf6d87801"
            ]
        ]
    },
    {
        "id": "ba7c49b99c1f4107",
        "type": "switch",
        "z": "d7f4697ea11dc8c3",
        "name": "payload empty?",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "empty"
            },
            {
                "t": "nempty"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 480,
        "y": 580,
        "wires": [
            [],
            [
                "480a9b8d1f04a5f8"
            ]
        ]
    },
    {
        "id": "480a9b8d1f04a5f8",
        "type": "split",
        "z": "d7f4697ea11dc8c3",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 630,
        "y": 580,
        "wires": [
            [
                "495b4518efb637c8"
            ]
        ]
    },
    {
        "id": "853e4fe318403293",
        "type": "switch",
        "z": "d7f4697ea11dc8c3",
        "name": "payload.cf_authors_ids[0] is empty?",
        "property": "payload.cf_authors_ids[0]",
        "propertyType": "msg",
        "rules": [
            {
                "t": "empty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 970,
        "y": 580,
        "wires": [
            [],
            [
                "847bb1232a6ea309"
            ]
        ]
    },
    {
        "id": "30f9952ebcb20ac7",
        "type": "inject",
        "z": "d7f4697ea11dc8c3",
        "name": "clear cf_authors_ids that are empty",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "update neurodiem set cf_authors_ids = NULL where cf_authors_ids = '[\"\"]';",
        "payload": "",
        "payloadType": "date",
        "x": 260,
        "y": 280,
        "wires": [
            [
                "541385b1ed11b5e4"
            ]
        ]
    },
    {
        "id": "541385b1ed11b5e4",
        "type": "sqlite",
        "z": "d7f4697ea11dc8c3",
        "mydb": "9ccc1658.e12858",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "",
        "x": 620,
        "y": 280,
        "wires": [
            [
                "42a5c5ed599ef311"
            ]
        ]
    },
    {
        "id": "cba443165684ac46",
        "type": "inject",
        "z": "f9371ec8fbbbf7f5",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 250,
        "y": 260,
        "wires": [
            [
                "9f55c0fb6e0d1c12"
            ]
        ]
    },
    {
        "id": "2feb87c83a9ef704",
        "type": "postgres",
        "z": "f9371ec8fbbbf7f5",
        "postgresdb": "857f821ab371a10e",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": true,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 380,
        "y": 380,
        "wires": [
            [
                "38747c38e0cafece"
            ]
        ]
    },
    {
        "id": "38747c38e0cafece",
        "type": "ui_table",
        "z": "f9371ec8fbbbf7f5",
        "group": "d3d6df44b735a435",
        "name": "",
        "order": 1,
        "width": "27",
        "height": "5",
        "columns": [
            {
                "field": "article_id",
                "title": "",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "link",
                "title": "",
                "width": "",
                "align": "left",
                "formatter": "link",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 1,
        "cts": true,
        "x": 510,
        "y": 380,
        "wires": [
            [
                "1f494ecccc9e86cb"
            ]
        ]
    },
    {
        "id": "1f494ecccc9e86cb",
        "type": "ui_form",
        "z": "f9371ec8fbbbf7f5",
        "name": "",
        "label": "doi form",
        "group": "d3d6df44b735a435",
        "order": 2,
        "width": 0,
        "height": 0,
        "options": [
            {
                "label": "",
                "value": "article_id",
                "type": "number",
                "required": true,
                "rows": null
            },
            {
                "label": "",
                "value": "doi",
                "type": "text",
                "required": true,
                "rows": null
            },
            {
                "label": "",
                "value": "link",
                "type": "text",
                "required": false,
                "rows": null
            }
        ],
        "formValue": {
            "article_id": "",
            "doi": "",
            "link": ""
        },
        "payload": "",
        "submit": "submit",
        "cancel": "cancel",
        "topic": "topic",
        "topicType": "msg",
        "splitLayout": "",
        "className": "",
        "x": 640,
        "y": 380,
        "wires": [
            [
                "42f24be69bb07ebb"
            ]
        ]
    },
    {
        "id": "42f24be69bb07ebb",
        "type": "sqlstring-format",
        "z": "f9371ec8fbbbf7f5",
        "name": "",
        "query": "update articles set doi = ? where article_id = ?;",
        "vars": "payload.doi,payload.article_id",
        "outField": "payload",
        "x": 770,
        "y": 380,
        "wires": [
            [
                "536f36484e18ad2a"
            ]
        ]
    },
    {
        "id": "536f36484e18ad2a",
        "type": "postgres",
        "z": "f9371ec8fbbbf7f5",
        "postgresdb": "857f821ab371a10e",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": true,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 900,
        "y": 380,
        "wires": [
            [
                "c469e3946e626558"
            ]
        ]
    },
    {
        "id": "9f55c0fb6e0d1c12",
        "type": "change",
        "z": "f9371ec8fbbbf7f5",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "select article_id,link from articles where doi IS NULL order by article_id desc;",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 220,
        "y": 380,
        "wires": [
            [
                "2feb87c83a9ef704"
            ]
        ]
    },
    {
        "id": "c469e3946e626558",
        "type": "link out",
        "z": "f9371ec8fbbbf7f5",
        "name": "link out 1",
        "mode": "link",
        "links": [
            "ef14466e6adac817"
        ],
        "x": 1095,
        "y": 380,
        "wires": []
    },
    {
        "id": "ef14466e6adac817",
        "type": "link in",
        "z": "f9371ec8fbbbf7f5",
        "name": "link in 1",
        "links": [
            "c469e3946e626558"
        ],
        "x": 65,
        "y": 380,
        "wires": [
            [
                "9f55c0fb6e0d1c12"
            ]
        ]
    },
    {
        "id": "daf5a6b46140efd5",
        "type": "inject",
        "z": "f9371ec8fbbbf7f5",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 280,
        "y": 500,
        "wires": [
            [
                "655cf3adc266a03f"
            ]
        ]
    },
    {
        "id": "47878597692b5785",
        "type": "postgres",
        "z": "f9371ec8fbbbf7f5",
        "postgresdb": "857f821ab371a10e",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": true,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 420,
        "y": 620,
        "wires": [
            [
                "8e134dd03c568f45"
            ]
        ]
    },
    {
        "id": "8e134dd03c568f45",
        "type": "ui_table",
        "z": "f9371ec8fbbbf7f5",
        "group": "d3d6df44b735a435",
        "name": "duplicate doi table",
        "order": 1,
        "width": 6,
        "height": 14,
        "columns": [
            {
                "field": "",
                "title": "row id",
                "width": "",
                "align": "left",
                "formatter": "rownum",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "doi",
                "title": "",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 1,
        "cts": true,
        "x": 290,
        "y": 720,
        "wires": [
            [
                "705b0d3f609b174d"
            ]
        ]
    },
    {
        "id": "655cf3adc266a03f",
        "type": "change",
        "z": "f9371ec8fbbbf7f5",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "SELECT   doi,   count(*) FROM articles GROUP BY   doi HAVING count(*) > 1;",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 250,
        "y": 620,
        "wires": [
            [
                "47878597692b5785"
            ]
        ]
    },
    {
        "id": "059af9f7b483a964",
        "type": "link out",
        "z": "f9371ec8fbbbf7f5",
        "d": true,
        "name": "link out 2",
        "mode": "link",
        "links": [
            "69bd6f021a84e71b",
            "324c2d4e5718bec1"
        ],
        "x": 1065,
        "y": 820,
        "wires": []
    },
    {
        "id": "69bd6f021a84e71b",
        "type": "link in",
        "z": "f9371ec8fbbbf7f5",
        "name": "link in 2",
        "links": [
            "059af9f7b483a964"
        ],
        "x": 95,
        "y": 620,
        "wires": [
            [
                "655cf3adc266a03f"
            ]
        ]
    },
    {
        "id": "705b0d3f609b174d",
        "type": "sqlstring-format",
        "z": "f9371ec8fbbbf7f5",
        "name": "",
        "query": "select article_id,title,summary,link,doi,relevant,ml_prediction_gnb,ml_prediction_lr,link from articles where doi = ?;",
        "vars": "payload.doi",
        "outField": "payload",
        "x": 450,
        "y": 720,
        "wires": [
            [
                "cbd2e8baec202925"
            ]
        ]
    },
    {
        "id": "cbd2e8baec202925",
        "type": "postgres",
        "z": "f9371ec8fbbbf7f5",
        "postgresdb": "857f821ab371a10e",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": true,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 580,
        "y": 720,
        "wires": [
            [
                "7a90eab844e62b24"
            ]
        ]
    },
    {
        "id": "bb8ea9d5f08b0c19",
        "type": "ui_table",
        "z": "f9371ec8fbbbf7f5",
        "group": "d3d6df44b735a435",
        "name": "dupes",
        "order": 2,
        "width": 14,
        "height": 7,
        "columns": [
            {
                "field": "",
                "title": "row id",
                "width": "",
                "align": "left",
                "formatter": "rownum",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "article_id",
                "title": "article_id",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "doi",
                "title": "doi",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "title",
                "title": "title",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "summary",
                "title": "summary",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "relevant",
                "title": "relevant",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "ml_prediction_gnb",
                "title": "ml_prediction_gnb",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "ml_prediction_lr",
                "title": "ml_prediction_lr",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "link",
                "title": "link",
                "width": "",
                "align": "left",
                "formatter": "link",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "admin",
                "title": "admin",
                "width": "",
                "align": "left",
                "formatter": "link",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 1,
        "cts": true,
        "x": 810,
        "y": 820,
        "wires": [
            [
                "0289737cc5fd8967"
            ]
        ]
    },
    {
        "id": "b2a638e4fea1244e",
        "type": "change",
        "z": "f9371ec8fbbbf7f5",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.admin",
                "pt": "msg",
                "to": "'https://api.gregory-ms.com/articles/' & payload.article_id",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 390,
        "y": 820,
        "wires": [
            [
                "57e042c1b969b4ad"
            ]
        ]
    },
    {
        "id": "7a90eab844e62b24",
        "type": "split",
        "z": "f9371ec8fbbbf7f5",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 710,
        "y": 720,
        "wires": [
            [
                "b2a638e4fea1244e"
            ]
        ]
    },
    {
        "id": "57e042c1b969b4ad",
        "type": "join",
        "z": "f9371ec8fbbbf7f5",
        "name": "",
        "mode": "auto",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": true,
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 570,
        "y": 820,
        "wires": [
            [
                "bb8ea9d5f08b0c19",
                "0289737cc5fd8967"
            ]
        ]
    },
    {
        "id": "0289737cc5fd8967",
        "type": "debug",
        "z": "f9371ec8fbbbf7f5",
        "name": "debug 15",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 500,
        "y": 980,
        "wires": []
    },
    {
        "id": "f783821b292a8fc6",
        "type": "inject",
        "z": "f9371ec8fbbbf7f5",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 110,
        "y": 1200,
        "wires": [
            [
                "4bbfb71020348033"
            ]
        ]
    },
    {
        "id": "08875c7ddcb73246",
        "type": "postgres",
        "z": "f9371ec8fbbbf7f5",
        "postgresdb": "857f821ab371a10e",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": true,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 480,
        "y": 1200,
        "wires": [
            [
                "d9633fc8f9a9f484"
            ]
        ]
    },
    {
        "id": "d9633fc8f9a9f484",
        "type": "ui_table",
        "z": "f9371ec8fbbbf7f5",
        "group": "cfbd39c9af3a16fa",
        "name": "deleter",
        "order": 1,
        "width": 20,
        "height": 10,
        "columns": [
            {
                "field": "",
                "title": "row id",
                "width": "",
                "align": "left",
                "formatter": "rownum",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "doi",
                "title": "",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 1,
        "cts": true,
        "x": 310,
        "y": 1300,
        "wires": [
            [
                "77a48663be7e7174"
            ]
        ]
    },
    {
        "id": "4bbfb71020348033",
        "type": "change",
        "z": "f9371ec8fbbbf7f5",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "SELECT   doi,   count(*) FROM articles GROUP BY   doi HAVING count(*) > 1;",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 310,
        "y": 1200,
        "wires": [
            [
                "08875c7ddcb73246"
            ]
        ]
    },
    {
        "id": "77a48663be7e7174",
        "type": "sqlstring-format",
        "z": "f9371ec8fbbbf7f5",
        "name": "",
        "query": "select article_id,title,summary,link,relevant,ml_prediction_gnb,ml_prediction_lr,link from articles where doi = ?;",
        "vars": "payload.doi",
        "outField": "payload",
        "x": 430,
        "y": 1300,
        "wires": [
            [
                "37fa46d13077b9c5"
            ]
        ]
    },
    {
        "id": "37fa46d13077b9c5",
        "type": "postgres",
        "z": "f9371ec8fbbbf7f5",
        "postgresdb": "857f821ab371a10e",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": true,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 560,
        "y": 1300,
        "wires": [
            [
                "3622537c91e91a2b"
            ]
        ]
    },
    {
        "id": "3622537c91e91a2b",
        "type": "split",
        "z": "f9371ec8fbbbf7f5",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 750,
        "y": 1340,
        "wires": [
            [
                "f27c017ee9ebd8a2"
            ]
        ]
    },
    {
        "id": "f27c017ee9ebd8a2",
        "type": "change",
        "z": "f9371ec8fbbbf7f5",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.admin",
                "pt": "msg",
                "to": "'https://api.gregory-ms.com/articles/' & payload.article_id",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 430,
        "y": 1440,
        "wires": [
            [
                "49387cc59a7ea1f3"
            ]
        ]
    },
    {
        "id": "49387cc59a7ea1f3",
        "type": "join",
        "z": "f9371ec8fbbbf7f5",
        "name": "",
        "mode": "auto",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": true,
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 610,
        "y": 1440,
        "wires": [
            [
                "cf211cb2133497d3"
            ]
        ]
    },
    {
        "id": "cf211cb2133497d3",
        "type": "ui_table",
        "z": "f9371ec8fbbbf7f5",
        "group": "cfbd39c9af3a16fa",
        "name": "deleter 2",
        "order": 2,
        "width": 0,
        "height": 0,
        "columns": [
            {
                "field": "article_id",
                "title": "article_id",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "title",
                "title": "title",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "summary",
                "title": "summary",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "relevant",
                "title": "relevant",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "link",
                "title": "link",
                "width": "",
                "align": "left",
                "formatter": "link",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "admin",
                "title": "admin",
                "width": "",
                "align": "left",
                "formatter": "link",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 1,
        "cts": true,
        "x": 740,
        "y": 1440,
        "wires": [
            [
                "8b88f9ba97c49bfa",
                "d72f99a5f0c7e426"
            ]
        ]
    },
    {
        "id": "0a95ed8ee465dcfc",
        "type": "debug",
        "z": "f9371ec8fbbbf7f5",
        "name": "debug 16",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 660,
        "y": 1660,
        "wires": []
    },
    {
        "id": "8b88f9ba97c49bfa",
        "type": "link out",
        "z": "f9371ec8fbbbf7f5",
        "name": "link out 3",
        "mode": "link",
        "links": [
            "29917ddc1124c80b"
        ],
        "x": 955,
        "y": 1440,
        "wires": []
    },
    {
        "id": "29917ddc1124c80b",
        "type": "link in",
        "z": "f9371ec8fbbbf7f5",
        "name": "link in 3",
        "links": [
            "8b88f9ba97c49bfa"
        ],
        "x": 55,
        "y": 1160,
        "wires": [
            [
                "4bbfb71020348033"
            ]
        ]
    },
    {
        "id": "d72f99a5f0c7e426",
        "type": "sqlstring-format",
        "z": "f9371ec8fbbbf7f5",
        "name": "",
        "query": "DELETE FROM articles_authors WHERE articles_id = ?;\nDELETE FROM articles WHERE article_id = ?;",
        "vars": "payload.article_id,payload.article_id",
        "outField": "payload",
        "x": 710,
        "y": 1540,
        "wires": [
            [
                "0a95ed8ee465dcfc"
            ]
        ]
    },
    {
        "id": "fa8a4a6fcc65b462",
        "type": "inject",
        "z": "ab5a10daa686af0d",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 200,
        "wires": [
            [
                "6bff553242a6bc24"
            ]
        ]
    },
    {
        "id": "6bff553242a6bc24",
        "type": "change",
        "z": "ab5a10daa686af0d",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "SELECT   article_id,link,doi FROM articles where summary is null limit 1;",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 350,
        "y": 220,
        "wires": [
            [
                "2a6e415c7a53559c"
            ]
        ]
    },
    {
        "id": "46d8002e098390aa",
        "type": "link in",
        "z": "ab5a10daa686af0d",
        "name": "link in 4",
        "links": [
            "874d9932c467197a"
        ],
        "x": 185,
        "y": 100,
        "wires": [
            [
                "6bff553242a6bc24"
            ]
        ]
    },
    {
        "id": "2a6e415c7a53559c",
        "type": "postgres",
        "z": "ab5a10daa686af0d",
        "postgresdb": "857f821ab371a10e",
        "name": "",
        "output": true,
        "perrow": true,
        "rowspermsg": "1",
        "return_on_error": true,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 520,
        "y": 220,
        "wires": [
            [
                "6461cf0118eed5c6",
                "19d926752a438a7f"
            ]
        ]
    },
    {
        "id": "874d9932c467197a",
        "type": "link out",
        "z": "ab5a10daa686af0d",
        "name": "link out 4",
        "mode": "link",
        "links": [
            "46d8002e098390aa"
        ],
        "x": 1025,
        "y": 140,
        "wires": []
    },
    {
        "id": "6461cf0118eed5c6",
        "type": "ui_form",
        "z": "ab5a10daa686af0d",
        "name": "",
        "label": "",
        "group": "ae19737811987bc8",
        "order": 1,
        "width": 0,
        "height": 0,
        "options": [
            {
                "label": "article_id",
                "value": "article_id",
                "type": "number",
                "required": true,
                "rows": null
            },
            {
                "label": "summary",
                "value": "summary",
                "type": "multiline",
                "required": true,
                "rows": 3
            },
            {
                "label": "link",
                "value": "link",
                "type": "text",
                "required": false,
                "rows": null
            }
        ],
        "formValue": {
            "article_id": "",
            "summary": "",
            "link": ""
        },
        "payload": "",
        "submit": "submit",
        "cancel": "cancel",
        "topic": "payload",
        "topicType": "msg",
        "splitLayout": "",
        "className": "",
        "x": 650,
        "y": 220,
        "wires": [
            [
                "1026e82a5f45026b"
            ]
        ]
    },
    {
        "id": "d997639dfad27c2d",
        "type": "debug",
        "z": "ab5a10daa686af0d",
        "name": "debug 18",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 930,
        "y": 400,
        "wires": []
    },
    {
        "id": "5f176be11def0ae6",
        "type": "sqlstring-format",
        "z": "ab5a10daa686af0d",
        "name": "",
        "query": "update articles set summary = ? where article_id = ?;",
        "vars": "payload.summary, payload.article_id",
        "outField": "payload",
        "x": 910,
        "y": 220,
        "wires": [
            [
                "d997639dfad27c2d",
                "535ca1f645c125a8"
            ]
        ]
    },
    {
        "id": "535ca1f645c125a8",
        "type": "postgres",
        "z": "ab5a10daa686af0d",
        "postgresdb": "857f821ab371a10e",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": true,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 1080,
        "y": 220,
        "wires": [
            [
                "d997639dfad27c2d",
                "874d9932c467197a"
            ]
        ]
    },
    {
        "id": "19d926752a438a7f",
        "type": "ui_text",
        "z": "ab5a10daa686af0d",
        "group": "ae19737811987bc8",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "text",
        "format": "<a href=\"{{msg.payload.link}}\" target=\"_blank\">{{msg.payload.link}}</a>",
        "layout": "row-center",
        "className": "",
        "x": 650,
        "y": 180,
        "wires": []
    },
    {
        "id": "1026e82a5f45026b",
        "type": "string",
        "z": "ab5a10daa686af0d",
        "name": "",
        "methods": [
            {
                "name": "replaceAll",
                "params": [
                    {
                        "type": "str",
                        "value": "'"
                    },
                    {
                        "type": "str",
                        "value": "''"
                    }
                ]
            }
        ],
        "prop": "payload.summary",
        "propout": "payload.summary",
        "object": "msg",
        "objectout": "msg",
        "x": 790,
        "y": 220,
        "wires": [
            [
                "5f176be11def0ae6"
            ]
        ]
    },
    {
        "id": "98edc96141a3d7fb",
        "type": "inject",
        "z": "340c3340fec3e5d6",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 210,
        "y": 220,
        "wires": [
            [
                "60197a4cba753e31"
            ]
        ]
    },
    {
        "id": "60197a4cba753e31",
        "type": "template",
        "z": "340c3340fec3e5d6",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "select * from articles where relevant IS NULL order by article_id desc limit 1 ;",
        "output": "str",
        "x": 220,
        "y": 260,
        "wires": [
            [
                "a0069d5ef3127999"
            ]
        ]
    },
    {
        "id": "a0069d5ef3127999",
        "type": "postgres",
        "z": "340c3340fec3e5d6",
        "postgresdb": "857f821ab371a10e",
        "name": "",
        "output": true,
        "perrow": true,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 220,
        "y": 300,
        "wires": [
            [
                "59d7ba1bf260a3f8",
                "ac81f9c5f5e6a0af",
                "de15c9096ba8741f",
                "2dea78f45a80f913",
                "3ad7ab4821b9f050",
                "d44e3ff863da9248"
            ]
        ]
    },
    {
        "id": "59d7ba1bf260a3f8",
        "type": "ui_text",
        "z": "340c3340fec3e5d6",
        "group": "75b526ea0330d05d",
        "order": 1,
        "width": 20,
        "height": 1,
        "name": "",
        "label": "",
        "format": "<h2>{{msg.payload.title}}</h2>",
        "layout": "col-center",
        "className": "",
        "x": 570,
        "y": 400,
        "wires": []
    },
    {
        "id": "ac81f9c5f5e6a0af",
        "type": "ui_button",
        "z": "340c3340fec3e5d6",
        "name": "",
        "group": "75b526ea0330d05d",
        "order": 6,
        "width": 9,
        "height": 1,
        "passthru": false,
        "label": "RELEVANT",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "relevant",
        "payloadType": "str",
        "topic": "payload.article_id",
        "topicType": "msg",
        "x": 730,
        "y": 200,
        "wires": [
            [
                "d507714b4181573b"
            ]
        ]
    },
    {
        "id": "d507714b4181573b",
        "type": "debug",
        "z": "340c3340fec3e5d6",
        "name": "debug 19",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 930,
        "y": 320,
        "wires": []
    },
    {
        "id": "de15c9096ba8741f",
        "type": "ui_text",
        "z": "340c3340fec3e5d6",
        "group": "75b526ea0330d05d",
        "order": 4,
        "width": 20,
        "height": 8,
        "name": "",
        "label": "abstract",
        "format": "{{msg.payload.summary}}",
        "layout": "col-center",
        "className": "",
        "x": 580,
        "y": 460,
        "wires": []
    },
    {
        "id": "2dea78f45a80f913",
        "type": "ui_text",
        "z": "340c3340fec3e5d6",
        "group": "75b526ea0330d05d",
        "order": 5,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "link",
        "format": "<a href=\"{{msg.payload.link}}\">{{msg.payload.link}}</a>",
        "layout": "col-center",
        "className": "",
        "x": 570,
        "y": 520,
        "wires": []
    },
    {
        "id": "25ee7dd5bd4f4b6b",
        "type": "ui_text",
        "z": "340c3340fec3e5d6",
        "group": "75b526ea0330d05d",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "prediction GNB",
        "format": "{{msg.payload.ml_prediction_gnb}}",
        "layout": "row-left",
        "className": "",
        "x": 720,
        "y": 100,
        "wires": []
    },
    {
        "id": "3ad7ab4821b9f050",
        "type": "function",
        "z": "340c3340fec3e5d6",
        "name": "function 1",
        "func": "msg.payload.ml_prediction_gnb = msg.payload.ml_prediction_gnb.toString()\n\nmsg.payload.ml_prediction_lr = msg.payload.ml_prediction_lr.toString()\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 120,
        "wires": [
            [
                "25ee7dd5bd4f4b6b",
                "10a69b022a364dfc"
            ]
        ]
    },
    {
        "id": "10a69b022a364dfc",
        "type": "ui_text",
        "z": "340c3340fec3e5d6",
        "group": "75b526ea0330d05d",
        "order": 3,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "prediction LR",
        "format": "{{msg.payload.ml_prediction_lr}}",
        "layout": "row-left",
        "className": "",
        "x": 720,
        "y": 140,
        "wires": []
    },
    {
        "id": "d44e3ff863da9248",
        "type": "ui_button",
        "z": "340c3340fec3e5d6",
        "name": "",
        "group": "75b526ea0330d05d",
        "order": 8,
        "width": 9,
        "height": 1,
        "passthru": false,
        "label": "Not relevant",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "not relevant",
        "payloadType": "str",
        "topic": "payload.article_id",
        "topicType": "msg",
        "x": 730,
        "y": 240,
        "wires": [
            [
                "d507714b4181573b"
            ]
        ]
    },
    {
        "id": "72715218ebac249e",
        "type": "http in",
        "z": "9b68d310eda6df17",
        "name": "",
        "url": "/bdh/articles",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 100,
        "y": 120,
        "wires": [
            [
                "9f3cb37a8772535a"
            ]
        ]
    },
    {
        "id": "de1908949f82cb58",
        "type": "sqlite",
        "z": "9b68d310eda6df17",
        "mydb": "9ccc1658.e12858",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "",
        "x": 560,
        "y": 120,
        "wires": [
            [
                "510c182a59b325f8",
                "621c0762d3a39c30"
            ]
        ]
    },
    {
        "id": "9f3cb37a8772535a",
        "type": "template",
        "z": "9b68d310eda6df17",
        "name": "",
        "field": "topic",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "select article_id,doi,journal,title,summary,takeaways,mla,cf_authors_ids,cf_journals_ids\n\n\nfrom neurodiem\nwhere journal is not null and summary is not null and mla is not null and title is not null and takeaways is not null and takeaways <> \"\"\nlimit 100;",
        "output": "str",
        "x": 380,
        "y": 120,
        "wires": [
            [
                "de1908949f82cb58"
            ]
        ]
    },
    {
        "id": "65401623.9abfe8",
        "type": "change",
        "z": "9b68d310eda6df17",
        "name": "Set Headers",
        "rules": [
            {
                "t": "set",
                "p": "headers",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "headers.content-type",
                "pt": "msg",
                "to": "application/json",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 950,
        "y": 120,
        "wires": [
            [
                "f7d3e35a.082c2"
            ]
        ]
    },
    {
        "id": "f7d3e35a.082c2",
        "type": "http response",
        "z": "9b68d310eda6df17",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1090,
        "y": 120,
        "wires": []
    },
    {
        "id": "510c182a59b325f8",
        "type": "debug",
        "z": "9b68d310eda6df17",
        "name": "debug 21",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 800,
        "y": 160,
        "wires": []
    },
    {
        "id": "621c0762d3a39c30",
        "type": "json",
        "z": "9b68d310eda6df17",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 790,
        "y": 120,
        "wires": [
            [
                "65401623.9abfe8"
            ]
        ]
    },
    {
        "id": "beb649b8ea89f656",
        "type": "http in",
        "z": "9b68d310eda6df17",
        "name": "",
        "url": "/bdh/articles/:article_id/",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 320,
        "wires": [
            [
                "88efba62e3a8bd82",
                "2b59e41e3ab1d8c7"
            ]
        ]
    },
    {
        "id": "95e1bdf35fb26af5",
        "type": "sqlite",
        "z": "9b68d310eda6df17",
        "mydb": "9ccc1658.e12858",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "",
        "x": 560,
        "y": 320,
        "wires": [
            [
                "afc4298e1fccec05"
            ]
        ]
    },
    {
        "id": "88efba62e3a8bd82",
        "type": "template",
        "z": "9b68d310eda6df17",
        "name": "",
        "field": "topic",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "select article_id,doi,journal,title,summary,takeaways,mla,cf_authors_ids,cf_journals_ids\n\n\nfrom neurodiem\n\nwhere article_id = {{req.params.article_id}}\nlimit 100;",
        "output": "str",
        "x": 380,
        "y": 320,
        "wires": [
            [
                "95e1bdf35fb26af5"
            ]
        ]
    },
    {
        "id": "aba76b04f86e3425",
        "type": "change",
        "z": "9b68d310eda6df17",
        "name": "Set Headers",
        "rules": [
            {
                "t": "set",
                "p": "headers",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "headers.content-type",
                "pt": "msg",
                "to": "application/json",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 870,
        "y": 320,
        "wires": [
            [
                "3b91184b12cd6684"
            ]
        ]
    },
    {
        "id": "3b91184b12cd6684",
        "type": "http response",
        "z": "9b68d310eda6df17",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1010,
        "y": 320,
        "wires": []
    },
    {
        "id": "afc4298e1fccec05",
        "type": "json",
        "z": "9b68d310eda6df17",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 730,
        "y": 320,
        "wires": [
            [
                "aba76b04f86e3425"
            ]
        ]
    },
    {
        "id": "2b59e41e3ab1d8c7",
        "type": "debug",
        "z": "9b68d310eda6df17",
        "name": "debug 22",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 610,
        "y": 560,
        "wires": []
    },
    {
        "id": "c3029eebb7241346",
        "type": "inject",
        "z": "485626b8bcd6fdb0",
        "name": "POST",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "600",
        "crontab": "",
        "once": true,
        "onceDelay": "10",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 440,
        "wires": [
            [
                "ab2581559d88e352"
            ]
        ]
    },
    {
        "id": "ca6fe223f9591a8d",
        "type": "function",
        "z": "485626b8bcd6fdb0",
        "name": "write status for mastodon",
        "func": "const { payload } = msg;\nlet { article_id, title, takeaways, link } = payload;\ngregory_link = `https://gregory-ms.com/articles/${article_id}/`\n\ntakeaways = takeaways.trimStart().replace(/ . /g, '. ');\n\npayload.status = `${title}\\n\\n${takeaways}\\n\\n${gregory_link}\\n\\n#MSchat #Neurology #MultipleSclerosis`;\nif (payload.status.length <= 500) {\n  return { article_id, payload };\n}\n\nfor (let i = 0; i < takeaways.length; i += 3) {\n  takeaways = takeaways.substring(0, takeaways.length - i);\n  payload.status = `${title}\\n\\n${takeaways} ...\\n\\n${gregory_link}\\n\\n#MSchat #Neurology #MultipleSclerosis #botsFightMS`;\n  if (payload.status.length <= 500) {\n    break;\n  }\n}\n\nreturn { article_id, payload };\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 270,
        "y": 520,
        "wires": [
            [
                "daab7cef48e0944e"
            ]
        ]
    },
    {
        "id": "daab7cef48e0944e",
        "type": "http request",
        "z": "485626b8bcd6fdb0",
        "name": "",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "body",
        "url": "https://med-mastodon.com/api/v1/statuses",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "bearer",
        "senderr": false,
        "headers": [],
        "x": 470,
        "y": 520,
        "wires": [
            [
                "9af21ec37395df87"
            ]
        ]
    },
    {
        "id": "5035d751f8744712",
        "type": "debug",
        "z": "485626b8bcd6fdb0",
        "name": "debug 24",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 380,
        "y": 640,
        "wires": []
    },
    {
        "id": "7c290dc97c0fb4f5",
        "type": "inject",
        "z": "485626b8bcd6fdb0",
        "name": "SETUP, RUN ONCE",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 40,
        "wires": [
            [
                "819e6149866f4afe"
            ]
        ]
    },
    {
        "id": "819e6149866f4afe",
        "type": "sqlite",
        "z": "485626b8bcd6fdb0",
        "mydb": "db2719fa1c93d724",
        "sqlquery": "fixed",
        "sql": "--DROP table articles;\nCREATE TABLE articles (\n    article_id INTEGER PRIMARY KEY,\n    title TEXT NOT NULL,\n    link TEXT NOT NULL,\n    takeaways TEXT NOT NULL,\n    sent BOOLEAN\n);",
        "name": "recreate articles table",
        "x": 340,
        "y": 40,
        "wires": [
            [
                "856a88afa70e8f8d"
            ]
        ]
    },
    {
        "id": "856a88afa70e8f8d",
        "type": "debug",
        "z": "485626b8bcd6fdb0",
        "name": "debug 25",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 720,
        "y": 180,
        "wires": []
    },
    {
        "id": "7e4b41c7b4cf6bf8",
        "type": "inject",
        "z": "485626b8bcd6fdb0",
        "name": "keep databases in sync",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "600",
        "crontab": "",
        "once": true,
        "onceDelay": "60",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 170,
        "y": 760,
        "wires": [
            [
                "65f93bbf1e8c0fee"
            ]
        ]
    },
    {
        "id": "65f93bbf1e8c0fee",
        "type": "sqlite",
        "z": "485626b8bcd6fdb0",
        "mydb": "db2719fa1c93d724",
        "sqlquery": "fixed",
        "sql": "select article_id from articles order by article_id desc;",
        "name": "",
        "x": 400,
        "y": 760,
        "wires": [
            [
                "f8e6f0b00663a4c3"
            ]
        ]
    },
    {
        "id": "f8e6f0b00663a4c3",
        "type": "switch",
        "z": "485626b8bcd6fdb0",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "empty"
            },
            {
                "t": "nempty"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 130,
        "y": 860,
        "wires": [
            [
                "fe8b218412847e33"
            ],
            [
                "6e0b254ba7276e7a"
            ]
        ]
    },
    {
        "id": "fe8b218412847e33",
        "type": "template",
        "z": "485626b8bcd6fdb0",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "select\n\t\"public\".\"articles\".\"article_id\" AS \"article_id\",\n\t\"public\".\"articles\".\"title\" AS \"title\",\n\t\"public\".\"articles\".\"summary\" AS \"summary\",\n\t\"public\".\"articles\".\"link\" AS \"link\",\n\t\"public\".\"articles\".\"published_date\" AS \"published_date\",\n\t\"public\".\"articles\".\"source\" AS \"source\",\n\t\"public\".\"articles\".\"relevant\" AS \"relevant\",\n\t\"public\".\"articles\".\"ml_prediction_gnb\" AS \"ml_prediction_gnb\",\n\t\"public\".\"articles\".\"ml_prediction_lr\" AS \"ml_prediction_lr\",\n\t\"public\".\"articles\".\"discovery_date\" AS \"discovery_date\",\n\t\"public\".\"articles\".\"noun_phrases\" AS \"noun_phrases\",\n\t\"public\".\"articles\".\"doi\" AS \"doi\",\n\t\"public\".\"articles\".\"access\" AS \"access\",\n\t\"public\".\"articles\".\"kind\" AS \"kind\",\n\t\"public\".\"articles\".\"publisher\" AS \"publisher\",\n\t\"public\".\"articles\".\"container_title\" AS \"container_title\",\n\t\"public\".\"articles\".\"takeaways\" as \"takeaways\",\n\tjson_agg(\"Authors\") as authors\nfrom articles\n\tLEFT JOIN \"public\".\"articles_authors\" \"Articles Authors\" ON \"public\".\"articles\".\"article_id\" = \"Articles Authors\".\"articles_id\"\n\tLEFT JOIN \"public\".\"authors\" \"Authors\" ON \"Articles Authors\".\"authors_id\" = \"Authors\".\"author_id\"\nwhere article_id not in (0)\n\tand takeaways is not null\n\tand (relevant = true or ml_prediction_gnb = true)\n\tgroup by \"article_id\"\n\torder by \"article_id\" desc\n;",
        "output": "str",
        "x": 280,
        "y": 840,
        "wires": [
            [
                "d1c5ce262e1b0883"
            ]
        ]
    },
    {
        "id": "6e0b254ba7276e7a",
        "type": "template",
        "z": "485626b8bcd6fdb0",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "select \n    \"public\".\"articles\".\"article_id\" AS \"article_id\",\n\t\"public\".\"articles\".\"title\" AS \"title\",\n\t\"public\".\"articles\".\"summary\" AS \"summary\",\n\t\"public\".\"articles\".\"link\" AS \"link\",\n\t\"public\".\"articles\".\"published_date\" AS \"published_date\",\n\t\"public\".\"articles\".\"source\" AS \"source\",\n\t\"public\".\"articles\".\"relevant\" AS \"relevant\",\n\t\"public\".\"articles\".\"ml_prediction_gnb\" AS \"ml_prediction_gnb\",\n\t\"public\".\"articles\".\"ml_prediction_lr\" AS \"ml_prediction_lr\",\n\t\"public\".\"articles\".\"discovery_date\" AS \"discovery_date\",\n\t\"public\".\"articles\".\"noun_phrases\" AS \"noun_phrases\",\n\t\"public\".\"articles\".\"doi\" AS \"doi\",\n\t\"public\".\"articles\".\"access\" AS \"access\",\n\t\"public\".\"articles\".\"kind\" AS \"kind\",\n\t\"public\".\"articles\".\"publisher\" AS \"publisher\",\n\t\"public\".\"articles\".\"container_title\" AS \"container_title\",\n\tjson_agg(\"Authors\") as authors\nfrom articles\n\tLEFT JOIN \"public\".\"articles_authors\" \"Articles Authors\" ON \"public\".\"articles\".\"article_id\" = \"Articles Authors\".\"articles_id\"\n\tLEFT JOIN \"public\".\"authors\" \"Authors\" ON \"Articles Authors\".\"authors_id\" = \"Authors\".\"author_id\"\nwhere article_id not in (\n\t\t{{ #payload}}{{article_id}},{{/payload}} 0)\nand takeaways is not null\nand (relevant = true or ml_prediction_gnb = true)\n\t\tgroup by \"article_id\"\n\t\torder by \"article_id\" desc\n;\n\n",
        "output": "str",
        "x": 280,
        "y": 880,
        "wires": [
            [
                "d1c5ce262e1b0883"
            ]
        ]
    },
    {
        "id": "d1c5ce262e1b0883",
        "type": "postgres",
        "z": "485626b8bcd6fdb0",
        "postgresdb": "857f821ab371a10e",
        "name": "",
        "output": true,
        "perrow": true,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "1",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 440,
        "y": 860,
        "wires": [
            [
                "af9c238922157b6e",
                "d7efb3385d8c9900"
            ]
        ]
    },
    {
        "id": "af9c238922157b6e",
        "type": "template",
        "z": "485626b8bcd6fdb0",
        "name": "insert articles into mastodonSQLITE",
        "field": "topic",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "insert into articles (article_id,link,title, takeaways, sent)\nvalues ({{payload.article_id}},\"{{{payload.link}}}\",\"{{payload.title}}\",\"{{payload.takeaways}}\",false);",
        "output": "str",
        "x": 770,
        "y": 860,
        "wires": [
            [
                "4da9a56fe6dbc9ec"
            ]
        ]
    },
    {
        "id": "4da9a56fe6dbc9ec",
        "type": "sqlite",
        "z": "485626b8bcd6fdb0",
        "mydb": "db2719fa1c93d724",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "",
        "x": 600,
        "y": 920,
        "wires": [
            [
                "d7efb3385d8c9900"
            ]
        ]
    },
    {
        "id": "d7efb3385d8c9900",
        "type": "debug",
        "z": "485626b8bcd6fdb0",
        "name": "debug 26",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 820,
        "y": 920,
        "wires": []
    },
    {
        "id": "e3d4302ac6881bf4",
        "type": "sqlite",
        "z": "485626b8bcd6fdb0",
        "mydb": "db2719fa1c93d724",
        "sqlquery": "fixed",
        "sql": "select * from articles where sent = False order by article_id desc limit 1;",
        "name": "example last row unsent",
        "x": 350,
        "y": 160,
        "wires": [
            [
                "856a88afa70e8f8d"
            ]
        ]
    },
    {
        "id": "d3fd196d0fedf2ee",
        "type": "inject",
        "z": "485626b8bcd6fdb0",
        "name": "get last row",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 160,
        "wires": [
            [
                "e3d4302ac6881bf4"
            ]
        ]
    },
    {
        "id": "ab2581559d88e352",
        "type": "sqlite",
        "z": "485626b8bcd6fdb0",
        "mydb": "db2719fa1c93d724",
        "sqlquery": "fixed",
        "sql": "SELECT article_id, title, link, takeaways, sent\nFROM articles\nWHERE sent = false\nORDER BY article_id DESC\nLIMIT 1;\n",
        "name": "",
        "x": 300,
        "y": 440,
        "wires": [
            [
                "436165120e827245"
            ]
        ]
    },
    {
        "id": "26b7caedb65a5f14",
        "type": "inject",
        "z": "485626b8bcd6fdb0",
        "name": "DROP TABLE",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 100,
        "wires": [
            [
                "a366c809bbe3159d"
            ]
        ]
    },
    {
        "id": "a366c809bbe3159d",
        "type": "sqlite",
        "z": "485626b8bcd6fdb0",
        "mydb": "db2719fa1c93d724",
        "sqlquery": "fixed",
        "sql": "DROP table articles;",
        "name": "DELETE articles table",
        "x": 340,
        "y": 100,
        "wires": [
            [
                "856a88afa70e8f8d"
            ]
        ]
    },
    {
        "id": "436165120e827245",
        "type": "split",
        "z": "485626b8bcd6fdb0",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 450,
        "y": 440,
        "wires": [
            [
                "ca6fe223f9591a8d",
                "7a4b0633e313fa84"
            ]
        ]
    },
    {
        "id": "9af21ec37395df87",
        "type": "switch",
        "z": "485626b8bcd6fdb0",
        "name": "",
        "property": "statusCode",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "200",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 190,
        "y": 580,
        "wires": [
            [
                "5a473571a0cdbf2a"
            ]
        ]
    },
    {
        "id": "7039ba0508f8eefd",
        "type": "sqlite",
        "z": "485626b8bcd6fdb0",
        "mydb": "db2719fa1c93d724",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "",
        "x": 220,
        "y": 640,
        "wires": [
            [
                "5035d751f8744712"
            ]
        ]
    },
    {
        "id": "5a473571a0cdbf2a",
        "type": "function",
        "z": "485626b8bcd6fdb0",
        "name": "create update statement",
        "func": "msg.topic = \"UPDATE articles SET sent = true WHERE article_id =\" + msg.article_id + \";\"\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 580,
        "wires": [
            [
                "7039ba0508f8eefd"
            ]
        ]
    },
    {
        "id": "d2a8272615e1dba8",
        "type": "inject",
        "z": "485626b8bcd6fdb0",
        "name": "count sent",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 160,
        "y": 220,
        "wires": [
            [
                "092b5354b53eec54"
            ]
        ]
    },
    {
        "id": "092b5354b53eec54",
        "type": "sqlite",
        "z": "485626b8bcd6fdb0",
        "mydb": "db2719fa1c93d724",
        "sqlquery": "fixed",
        "sql": "select count(*) from articles where sent = true ;",
        "name": "count sent",
        "x": 310,
        "y": 220,
        "wires": [
            [
                "856a88afa70e8f8d"
            ]
        ]
    },
    {
        "id": "90c3f8a92c617129",
        "type": "sqlite",
        "z": "485626b8bcd6fdb0",
        "mydb": "db2719fa1c93d724",
        "sqlquery": "fixed",
        "sql": "select count(*) from articles where sent = false ;",
        "name": "count unsent",
        "x": 310,
        "y": 280,
        "wires": [
            [
                "92f330dcf17d1487"
            ]
        ]
    },
    {
        "id": "4d67c0f926205c78",
        "type": "inject",
        "z": "485626b8bcd6fdb0",
        "name": "count unsent",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 280,
        "wires": [
            [
                "90c3f8a92c617129"
            ]
        ]
    },
    {
        "id": "92f330dcf17d1487",
        "type": "change",
        "z": "485626b8bcd6fdb0",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload[0][\"count(*)\"]",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 480,
        "y": 280,
        "wires": [
            [
                "856a88afa70e8f8d"
            ]
        ]
    },
    {
        "id": "746a952489a80f69",
        "type": "http in",
        "z": "485626b8bcd6fdb0",
        "name": "",
        "url": "/mastodon",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 1040,
        "wires": [
            [
                "d4e05edf457822fe"
            ]
        ]
    },
    {
        "id": "d4e05edf457822fe",
        "type": "sqlite",
        "z": "485626b8bcd6fdb0",
        "mydb": "db2719fa1c93d724",
        "sqlquery": "fixed",
        "sql": "SELECT article_id, title, link, takeaways, sent\nFROM articles\nORDER BY article_id DESC;\n",
        "name": "",
        "x": 320,
        "y": 1040,
        "wires": [
            [
                "827c8190a62a69af"
            ]
        ]
    },
    {
        "id": "488fc13a68fd8899",
        "type": "http response",
        "z": "485626b8bcd6fdb0",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 590,
        "y": 1040,
        "wires": []
    },
    {
        "id": "827c8190a62a69af",
        "type": "json",
        "z": "485626b8bcd6fdb0",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 470,
        "y": 1040,
        "wires": [
            [
                "488fc13a68fd8899"
            ]
        ]
    },
    {
        "id": "2d8eab51cf05a77f",
        "type": "inject",
        "z": "485626b8bcd6fdb0",
        "name": "POST",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "10",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 570,
        "y": 1180,
        "wires": [
            [
                "85ee03e8d0a33b98"
            ]
        ]
    },
    {
        "id": "7a4b0633e313fa84",
        "type": "function",
        "z": "485626b8bcd6fdb0",
        "name": "write status for bsky",
        "func": "let { article_id, title, takeaways, link } = msg.payload;\ngregory_link = `https://gregory-ms.com/articles/${article_id}/`\n\ntakeaways = takeaways.trimStart().replace(/ . /g, '. ');\n\ntext = `${gregory_link}\\n${title}\\n${takeaways}\\n\\n#MSchat #Neurology #MultipleSclerosis #NeuroSky #NeuroSkyence`;\n\nif (takeaways != ''){\n    for (let i = 0; i < takeaways.length; i += 3) {\n        takeaways = takeaways.substring(0, takeaways.length - i);\n        text = `${title}\\n${takeaways}\\n[${gregory_link}](${gregory_link})\\n\\n#MSchat #Neurology #MultipleSclerosis`;\n        if (text <= 300) {\n            break;\n        }\n    }\n}\n\n//msg.payload.status = msg.status;  // If you want status to be a part of payload\nreturn { article_id, text,link, gregory_link };",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 740,
        "y": 500,
        "wires": [
            [
                "eb67675eda755f4c"
            ]
        ]
    },
    {
        "id": "eb67675eda755f4c",
        "type": "function",
        "z": "485626b8bcd6fdb0",
        "name": "payload for session token",
        "func": "msg.url = \"https://bsky.social/xrpc/com.atproto.server.createSession\";\nmsg.method = \"POST\";\nmsg.headers = {\n    \"Content-Type\": \"application/json\"\n};\nmsg.payload = {\n    \"identifier\": \"did:plc:xqiepmiqfqvtv6llwew76ixb\", \n    \"password\": \"4oai-srq6-bdg3-yc34\"\n};\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 990,
        "y": 500,
        "wires": [
            [
                "43bbc27889634e04"
            ]
        ]
    },
    {
        "id": "95bc6fe1bf8d6ea7",
        "type": "debug",
        "z": "485626b8bcd6fdb0",
        "name": "debug 39",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 900,
        "y": 620,
        "wires": []
    },
    {
        "id": "43bbc27889634e04",
        "type": "http request",
        "z": "485626b8bcd6fdb0",
        "name": "",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "https://bsky.social/xrpc/com.atproto.server.createSession",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1190,
        "y": 500,
        "wires": [
            [
                "f5caa54c3902b42f"
            ]
        ]
    },
    {
        "id": "dc0fc124c5fe45d1",
        "type": "function",
        "z": "485626b8bcd6fdb0",
        "name": "payload for bsky api",
        "func": "let text = msg.text;\nlet link = msg.link\nlet gregory_link = msg.gregory_link\nif (text.length > 300) {\n    // handle the case when the text is too long\n    text = text.substring(0, 300);  // this will truncate the text to 300 characters\n    // note that if you have complex Unicode characters or emojis, you may need a more complex function to count graphemes\n}\n\nlet data = {\n    \"collection\": \"app.bsky.feed.post\", \n    \"repo\": msg.payload.did, \n    \"record\": {\n        \"text\": text, \n        \"langs\": [ \"en\" ],\n        \"createdAt\": new Date().toISOString(), \n        \"$type\": \"app.bsky.feed.post\",\n            \"facets\": [{\n        \"features\": [{\n            \"uri\": gregory_link,\n            \"$type\": \"app.bsky.richtext.facet#link\"\n        }],\n          \"index\":{\"byteStart\":0,\"byteEnd\":gregory_link.length},\n        \n    }]\n}};\nmsg.payload = JSON.stringify(data);\n\nmsg.headers = {\n    Authorization: \"Bearer \"+ msg.accessJwt,\n    \"Content-Type\": \"application/json\"\n}\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1000,
        "y": 560,
        "wires": [
            [
                "b453ddef29e5de2e"
            ]
        ]
    },
    {
        "id": "b453ddef29e5de2e",
        "type": "http request",
        "z": "485626b8bcd6fdb0",
        "name": "",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "body",
        "url": "https://bsky.social/xrpc/com.atproto.repo.createRecord",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 750,
        "y": 620,
        "wires": [
            [
                "95bc6fe1bf8d6ea7"
            ]
        ]
    },
    {
        "id": "f5caa54c3902b42f",
        "type": "change",
        "z": "485626b8bcd6fdb0",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "accessJwt",
                "pt": "msg",
                "to": "payload.accessJwt",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 770,
        "y": 560,
        "wires": [
            [
                "dc0fc124c5fe45d1"
            ]
        ]
    },
    {
        "id": "85ee03e8d0a33b98",
        "type": "sqlite",
        "z": "485626b8bcd6fdb0",
        "mydb": "db2719fa1c93d724",
        "sqlquery": "fixed",
        "sql": "SELECT article_id, title, link, takeaways, sent\nFROM articles\nWHERE sent = true\nORDER BY article_id DESC\nLIMIT 1;\n",
        "name": "",
        "x": 720,
        "y": 1180,
        "wires": [
            [
                "667bd8d5257ae510"
            ]
        ]
    },
    {
        "id": "667bd8d5257ae510",
        "type": "split",
        "z": "485626b8bcd6fdb0",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 870,
        "y": 1180,
        "wires": [
            []
        ]
    },
    {
        "id": "45cc9f54ac1d13d2",
        "type": "inject",
        "z": "324a04c46cb08394",
        "name": "POST",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "3600",
        "crontab": "",
        "once": true,
        "onceDelay": "15",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 380,
        "wires": [
            [
                "fb1bd2c88b586840"
            ]
        ]
    },
    {
        "id": "0a4728c8d6bc5303",
        "type": "function",
        "z": "324a04c46cb08394",
        "name": "write status",
        "func": "const { payload } = msg;\nconst { trial_id, title, takeaways, link } = payload;\n\npayload.status = `${title}\\n\\n${link}\\n\\n#MSchat #Neurology #MultipleSclerosis #ClinicalTrial #botsFightMS`;\n\nreturn { trial_id, payload };\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 210,
        "y": 460,
        "wires": [
            [
                "4a8fe1246940302e"
            ]
        ]
    },
    {
        "id": "4a8fe1246940302e",
        "type": "http request",
        "z": "324a04c46cb08394",
        "name": "",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "body",
        "url": "https://med-mastodon.com/api/v1/statuses",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "bearer",
        "senderr": false,
        "headers": [],
        "x": 370,
        "y": 460,
        "wires": [
            [
                "1b853bd9af860a72"
            ]
        ]
    },
    {
        "id": "c1b2b358746821a5",
        "type": "debug",
        "z": "324a04c46cb08394",
        "name": "debug 27",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 400,
        "y": 540,
        "wires": []
    },
    {
        "id": "1cfc928c2f0488fa",
        "type": "inject",
        "z": "324a04c46cb08394",
        "name": "SETUP, RUN ONCE",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 110,
        "y": 120,
        "wires": [
            [
                "77324e4d683e834c"
            ]
        ]
    },
    {
        "id": "77324e4d683e834c",
        "type": "sqlite",
        "z": "324a04c46cb08394",
        "mydb": "db2719fa1c93d724",
        "sqlquery": "fixed",
        "sql": "--DROP table trials;\nCREATE TABLE trials (\n    trial_id INTEGER PRIMARY KEY,\n    title TEXT NOT NULL,\n    link TEXT NOT NULL,\n    sent BOOLEAN\n);",
        "name": "recreate trials table",
        "x": 310,
        "y": 120,
        "wires": [
            [
                "0add22b704ff9ff8"
            ]
        ]
    },
    {
        "id": "0add22b704ff9ff8",
        "type": "debug",
        "z": "324a04c46cb08394",
        "name": "debug 28",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 530,
        "y": 140,
        "wires": []
    },
    {
        "id": "d792e7b4af2a11a0",
        "type": "inject",
        "z": "324a04c46cb08394",
        "name": "keep databases in sync",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "600",
        "crontab": "",
        "once": true,
        "onceDelay": "60",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 720,
        "wires": [
            [
                "2105d67c8e98d794"
            ]
        ]
    },
    {
        "id": "2105d67c8e98d794",
        "type": "sqlite",
        "z": "324a04c46cb08394",
        "mydb": "db2719fa1c93d724",
        "sqlquery": "fixed",
        "sql": "select trial_id from trials order by trial_id desc;",
        "name": "",
        "x": 380,
        "y": 720,
        "wires": [
            [
                "b819fc97c762af53"
            ]
        ]
    },
    {
        "id": "b819fc97c762af53",
        "type": "switch",
        "z": "324a04c46cb08394",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "empty"
            },
            {
                "t": "nempty"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 110,
        "y": 820,
        "wires": [
            [
                "bd42d9371bbaf3d8"
            ],
            [
                "db8357ab04941ac7"
            ]
        ]
    },
    {
        "id": "bd42d9371bbaf3d8",
        "type": "template",
        "z": "324a04c46cb08394",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "select\n\t*\nfrom trials\n\nwhere trial_id not in (0)\n\torder by \"trial_id\" desc\n;",
        "output": "str",
        "x": 260,
        "y": 800,
        "wires": [
            [
                "bc32d187d999eac0"
            ]
        ]
    },
    {
        "id": "db8357ab04941ac7",
        "type": "template",
        "z": "324a04c46cb08394",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "select \n    *\nfrom trials\n\t\nwhere trial_id not in (\n\t\t{{ #payload}}{{trial_id}},{{/payload}} 0)\n\n\t\torder by \"trial_id\" desc\n;\n\n",
        "output": "str",
        "x": 260,
        "y": 840,
        "wires": [
            [
                "bc32d187d999eac0"
            ]
        ]
    },
    {
        "id": "bc32d187d999eac0",
        "type": "postgres",
        "z": "324a04c46cb08394",
        "postgresdb": "857f821ab371a10e",
        "name": "",
        "output": true,
        "perrow": true,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "1",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 420,
        "y": 820,
        "wires": [
            [
                "7c6aa6036c0be243"
            ]
        ]
    },
    {
        "id": "7c6aa6036c0be243",
        "type": "template",
        "z": "324a04c46cb08394",
        "name": "insert trials into mastodonSQLITE",
        "field": "topic",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "insert into trials (trial_id,link,title, sent)\nvalues ({{payload.trial_id}},\"{{{payload.link}}}\",\"{{payload.title}}\",false);",
        "output": "str",
        "x": 640,
        "y": 820,
        "wires": [
            [
                "53b04f5e64880246"
            ]
        ]
    },
    {
        "id": "53b04f5e64880246",
        "type": "sqlite",
        "z": "324a04c46cb08394",
        "mydb": "db2719fa1c93d724",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "",
        "x": 580,
        "y": 880,
        "wires": [
            [
                "284ea4e0298ba525"
            ]
        ]
    },
    {
        "id": "284ea4e0298ba525",
        "type": "debug",
        "z": "324a04c46cb08394",
        "name": "debug 29",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 740,
        "y": 880,
        "wires": []
    },
    {
        "id": "8593905eefa4f705",
        "type": "sqlite",
        "z": "324a04c46cb08394",
        "mydb": "db2719fa1c93d724",
        "sqlquery": "fixed",
        "sql": "select * from trials where sent = true order by trial_id desc limit 1;",
        "name": "example last row sent",
        "x": 320,
        "y": 240,
        "wires": [
            [
                "0add22b704ff9ff8"
            ]
        ]
    },
    {
        "id": "c807363baf8a5e51",
        "type": "inject",
        "z": "324a04c46cb08394",
        "name": "get last row",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 240,
        "wires": [
            [
                "8593905eefa4f705"
            ]
        ]
    },
    {
        "id": "fb1bd2c88b586840",
        "type": "sqlite",
        "z": "324a04c46cb08394",
        "mydb": "db2719fa1c93d724",
        "sqlquery": "fixed",
        "sql": "SELECT trial_id, title, link, sent\nFROM trials\nWHERE sent = false\nORDER BY trial_id DESC\nLIMIT 1;\n",
        "name": "",
        "x": 300,
        "y": 380,
        "wires": [
            [
                "936808444a93e199"
            ]
        ]
    },
    {
        "id": "1ae39f7c4c3b7084",
        "type": "inject",
        "z": "324a04c46cb08394",
        "name": "DROP TABLE",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 180,
        "wires": [
            [
                "9c95b2b315b7c440"
            ]
        ]
    },
    {
        "id": "9c95b2b315b7c440",
        "type": "sqlite",
        "z": "324a04c46cb08394",
        "mydb": "db2719fa1c93d724",
        "sqlquery": "fixed",
        "sql": "DROP table trials;",
        "name": "DELETE trials table",
        "x": 310,
        "y": 180,
        "wires": [
            [
                "0add22b704ff9ff8"
            ]
        ]
    },
    {
        "id": "936808444a93e199",
        "type": "split",
        "z": "324a04c46cb08394",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 450,
        "y": 380,
        "wires": [
            [
                "0a4728c8d6bc5303",
                "b29dddc03a6a6030"
            ]
        ]
    },
    {
        "id": "1b853bd9af860a72",
        "type": "switch",
        "z": "324a04c46cb08394",
        "name": "",
        "property": "statusCode",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "200",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 230,
        "y": 500,
        "wires": [
            [
                "eb894ca7895a0f8d"
            ]
        ]
    },
    {
        "id": "2345b0f8fd69844a",
        "type": "sqlite",
        "z": "324a04c46cb08394",
        "mydb": "db2719fa1c93d724",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "",
        "x": 240,
        "y": 540,
        "wires": [
            [
                "c1b2b358746821a5"
            ]
        ]
    },
    {
        "id": "eb894ca7895a0f8d",
        "type": "function",
        "z": "324a04c46cb08394",
        "name": "create update statement",
        "func": "msg.topic = \"UPDATE trials SET sent = true WHERE trial_id =\" + msg.trial_id + \";\"\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 500,
        "wires": [
            [
                "2345b0f8fd69844a"
            ]
        ]
    },
    {
        "id": "2b3e20d3217dce4a",
        "type": "inject",
        "z": "324a04c46cb08394",
        "name": "count unsent",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 300,
        "wires": [
            [
                "abd5c1169828f83e"
            ]
        ]
    },
    {
        "id": "abd5c1169828f83e",
        "type": "sqlite",
        "z": "324a04c46cb08394",
        "mydb": "db2719fa1c93d724",
        "sqlquery": "fixed",
        "sql": "select count(*) from trials where sent = false ;",
        "name": "count unsent",
        "x": 290,
        "y": 300,
        "wires": [
            [
                "ed19f4350e32d103"
            ]
        ]
    },
    {
        "id": "ed19f4350e32d103",
        "type": "change",
        "z": "324a04c46cb08394",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload[0][\"count(*)\"]",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 460,
        "y": 300,
        "wires": [
            [
                "0add22b704ff9ff8"
            ]
        ]
    },
    {
        "id": "89bee53dc2f074f0",
        "type": "sqlite",
        "z": "324a04c46cb08394",
        "mydb": "db2719fa1c93d724",
        "sqlquery": "fixed",
        "sql": "update trials set sent = 1 where sent = 0 or sent = NULL",
        "name": "update trials",
        "x": 810,
        "y": 160,
        "wires": [
            [
                "9a8249d482566cf3"
            ]
        ]
    },
    {
        "id": "cbb1bc754ecce81d",
        "type": "inject",
        "z": "324a04c46cb08394",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 650,
        "y": 260,
        "wires": [
            [
                "89bee53dc2f074f0"
            ]
        ]
    },
    {
        "id": "9a8249d482566cf3",
        "type": "debug",
        "z": "324a04c46cb08394",
        "name": "debug 31",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 950,
        "y": 220,
        "wires": []
    },
    {
        "id": "b29dddc03a6a6030",
        "type": "function",
        "z": "324a04c46cb08394",
        "name": "write status for bsky",
        "func": "let { article_id, title, takeaways, link } = msg.payload;\n\ntext = `${title}\\n\\n${link}\\n\\n#MSchat #Neurology #MultipleSclerosis #ClinicalTrial #botsFightMS`;\n\n\nif (takeaways != ''){\n    for (let i = 0; i < takeaways.length; i += 3) {\n        takeaways = takeaways.substring(0, takeaways.length - i);\n        text = `${title}\\n\\n${takeaways}\\n\\n${link}\\n\\n#MSchat #Neurology #MultipleSclerosis #ClinicalTrial #botsFightMS`;        \n        if (text <= 500) {\n            break;\n        }\n    }\n}\n\n//msg.payload.status = msg.status;  // If you want status to be a part of payload\nreturn { article_id, text };",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 680,
        "y": 380,
        "wires": [
            [
                "6a15a360f0a09f9e"
            ]
        ]
    },
    {
        "id": "6a15a360f0a09f9e",
        "type": "function",
        "z": "324a04c46cb08394",
        "name": "payload for session token",
        "func": "msg.url = \"https://bsky.social/xrpc/com.atproto.server.createSession\";\nmsg.method = \"POST\";\nmsg.headers = {\n    \"Content-Type\": \"application/json\"\n};\nmsg.payload = {\n    \"identifier\": \"did:plc:xqiepmiqfqvtv6llwew76ixb\", \n    \"password\": \"4oai-srq6-bdg3-yc34\"\n};\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 380,
        "wires": [
            [
                "29681eae3d37cd8d"
            ]
        ]
    },
    {
        "id": "29681eae3d37cd8d",
        "type": "http request",
        "z": "324a04c46cb08394",
        "name": "",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "https://bsky.social/xrpc/com.atproto.server.createSession",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1110,
        "y": 380,
        "wires": [
            [
                "9613bdabfc8e5faa"
            ]
        ]
    },
    {
        "id": "dc8899b04cd919f6",
        "type": "http request",
        "z": "324a04c46cb08394",
        "name": "",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "body",
        "url": "https://bsky.social/xrpc/com.atproto.repo.createRecord",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1110,
        "y": 440,
        "wires": [
            [
                "131453eeba2175db"
            ]
        ]
    },
    {
        "id": "b34534916cb4eb38",
        "type": "function",
        "z": "324a04c46cb08394",
        "name": "payload for bsky api",
        "func": "let text = msg.text;\nlet link = msg.link\nif (text.length > 300) {\n    // handle the case when the text is too long\n    text = text.substring(0, 300);  // this will truncate the text to 300 characters\n    // note that if you have complex Unicode characters or emojis, you may need a more complex function to count graphemes\n}\n\nlet data = {\n    \"collection\": \"app.bsky.feed.post\", \n    \"repo\": msg.payload.did, \n    \"record\": {\n        \"text\": text, \n        \"createdAt\": new Date().toISOString(), \n        \"$type\": \"app.bsky.feed.post\",\n            \"facets\": [{\n        \"features\": [{\n            \"uri\": link,\n            \"$type\": \"app.bsky.richtext.facet#link\"\n        }],\n          \"index\":{\"byteStart\":0,\"byteEnd\":link.length},\n        \n    }]\n}};\nmsg.payload = JSON.stringify(data);\n\nmsg.headers = {\n    Authorization: \"Bearer \"+ msg.accessJwt,\n    \"Content-Type\": \"application/json\"\n}\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 440,
        "wires": [
            [
                "dc8899b04cd919f6"
            ]
        ]
    },
    {
        "id": "9613bdabfc8e5faa",
        "type": "change",
        "z": "324a04c46cb08394",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "accessJwt",
                "pt": "msg",
                "to": "payload.accessJwt",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 710,
        "y": 440,
        "wires": [
            [
                "b34534916cb4eb38"
            ]
        ]
    },
    {
        "id": "131453eeba2175db",
        "type": "debug",
        "z": "324a04c46cb08394",
        "name": "debug 40",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1260,
        "y": 440,
        "wires": []
    },
    {
        "id": "e9d5975406bbe70e",
        "type": "sqlite",
        "z": "1c5bb98919947223",
        "mydb": "4374af16959005e4",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "",
        "x": 650,
        "y": 200,
        "wires": [
            [
                "81066822864a9b62"
            ]
        ]
    },
    {
        "id": "c31f697d7025481f",
        "type": "template",
        "z": "1c5bb98919947223",
        "name": "create table",
        "field": "topic",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "CREATE TABLE bank_transactions (\n    transaction_date DATE,\n    value_date DATE,\n    description TEXT,\n    amount REAL,\n    currency TEXT,\n    accounting_balance REAL\n);\n",
        "output": "str",
        "x": 410,
        "y": 120,
        "wires": [
            [
                "e9d5975406bbe70e"
            ]
        ]
    },
    {
        "id": "81066822864a9b62",
        "type": "debug",
        "z": "1c5bb98919947223",
        "name": "debug 41",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 950,
        "y": 180,
        "wires": []
    },
    {
        "id": "58d283225b4314b6",
        "type": "inject",
        "z": "1c5bb98919947223",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 240,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "54a126eeb4e9f30d",
        "type": "template",
        "z": "1c5bb98919947223",
        "name": "insert data",
        "field": "topic",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "INSERT INTO bank_transactions (transaction_date, value_date, description, amount, accounting_balance, currency)\nVALUES \n('2023-11-06', '2023-11-06', 'I.SELO OP.BANC.', -0.03, 9.16, 'euro'),\n('2023-11-06', '2023-11-06', 'COMISSO MANUTENO DE CONTA', -0.81, 9.19, 'euro'),\n('2023-11-06', '2023-11-06', 'TR-IPS-BRUNO AMARAL TIAGO', 10.00, 10.00, 'euro'),\n('2023-11-03', '2023-11-03', 'I.SELO OP.BANC.', -0.21, 0.00, 'euro'),\n('2023-11-03', '2023-11-03', 'COMISSO MANUTENO DE CONTA', -5.19, 0.21, 'euro'),\n('2023-10-25', '2023-10-25', 'TR-STRIPE', 2.70, 5.40, 'euro'),\n('2023-10-25', '2023-10-25', 'TR-Stripe Technology Europe Lt', 2.70, 2.70, 'euro');\n",
        "output": "str",
        "x": 410,
        "y": 160,
        "wires": [
            [
                "e9d5975406bbe70e"
            ]
        ]
    },
    {
        "id": "bb3b230139a2da17",
        "type": "http in",
        "z": "1c5bb98919947223",
        "name": "",
        "url": "/human-singularity",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 370,
        "y": 520,
        "wires": [
            [
                "ac88bcae84449436"
            ]
        ]
    },
    {
        "id": "ac88bcae84449436",
        "type": "template",
        "z": "1c5bb98919947223",
        "name": "",
        "field": "topic",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "select * from bank_transactions;",
        "output": "str",
        "x": 590,
        "y": 520,
        "wires": [
            [
                "f32177edb7a57845"
            ]
        ]
    },
    {
        "id": "f32177edb7a57845",
        "type": "sqlite",
        "z": "1c5bb98919947223",
        "mydb": "4374af16959005e4",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "",
        "x": 790,
        "y": 520,
        "wires": [
            [
                "f8e72f0a261a64c5",
                "825f4f7e5a206124"
            ]
        ]
    },
    {
        "id": "825f4f7e5a206124",
        "type": "http response",
        "z": "1c5bb98919947223",
        "name": "",
        "statusCode": "200",
        "headers": {
            "content-type": "application/json"
        },
        "x": 1020,
        "y": 520,
        "wires": []
    },
    {
        "id": "1e3c62f30fe8d67f",
        "type": "inject",
        "z": "1c5bb98919947223",
        "name": "reset db table",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "delete from bank_transactions;",
        "payload": "",
        "payloadType": "date",
        "x": 420,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "f8e72f0a261a64c5",
        "type": "debug",
        "z": "1c5bb98919947223",
        "name": "debug 42",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 880,
        "y": 580,
        "wires": []
    },
    {
        "id": "ab636d2e9eb640b9",
        "type": "inject",
        "z": "1c5bb98919947223",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 570,
        "y": 440,
        "wires": [
            [
                "ac88bcae84449436"
            ]
        ]
    },
    {
        "id": "4013df719b33dcb1",
        "type": "csv",
        "z": "1c5bb98919947223",
        "name": "",
        "sep": ",",
        "hdrin": true,
        "hdrout": "none",
        "multi": "mult",
        "ret": "\\n",
        "temp": "",
        "skip": "0",
        "strings": true,
        "include_empty_strings": true,
        "include_null_values": true,
        "x": 430,
        "y": 320,
        "wires": [
            [
                "8ec24d83318c7c9d"
            ]
        ]
    },
    {
        "id": "cd5769700853ed07",
        "type": "inject",
        "z": "1c5bb98919947223",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "transaction_date,value_date,description,amount,currency,accounting_balance 2023-11-06,2023-11-06,\"I.SELO OP.BANC.\",-0.03,euro,9.16 2023-11-06,2023-11-06,\"COMISSO MANUTENO DE CONTA\",-0.81,euro,9.19 2023-11-06,2023-11-06,\"TR-IPS-BRUNO AMARAL TIAGO\",10,euro,10 2023-11-03,2023-11-03,\"I.SELO OP.BANC.\",-0.21,euro,0 2023-11-03,2023-11-03,\"COMISSO MANUTENO DE CONTA\",-5.19,euro,0.21 2023-10-25,2023-10-25,\"TR-STRIPE\",2.7,euro,5.4 2023-10-25,2023-10-25,\"TR-Stripe Technology Europe Lt\",2.7,euro,2.7",
        "payloadType": "str",
        "x": 130,
        "y": 340,
        "wires": [
            [
                "94df76c4afb87d64"
            ]
        ]
    },
    {
        "id": "94df76c4afb87d64",
        "type": "template",
        "z": "1c5bb98919947223",
        "name": "paste CSV here",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "",
        "output": "str",
        "x": 280,
        "y": 320,
        "wires": [
            [
                "4013df719b33dcb1"
            ]
        ]
    },
    {
        "id": "1c107858ad11da45",
        "type": "template",
        "z": "1c5bb98919947223",
        "name": "insert data",
        "field": "topic",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "INSERT INTO bank_transactions (transaction_date, value_date, description, amount, accounting_balance, currency)\nVALUES \n{{#payload}}\n  ('{{transaction_date}}', '{{value_date}}', '{{description}}', {{amount}}, {{accounting_balance}}, '{{currency}}'){{^last}},{{/last}}\n{{/payload}};\n",
        "output": "str",
        "x": 790,
        "y": 320,
        "wires": [
            [
                "e9d5975406bbe70e"
            ]
        ]
    },
    {
        "id": "8ec24d83318c7c9d",
        "type": "function",
        "z": "1c5bb98919947223",
        "name": "add msg.payload.last",
        "func": "// Assuming msg.payload is the array of transactions\nfor (let i = 0; i < msg.payload.length; i++) {\n  // Add a 'last' property to the last item\n  msg.payload[i].last = (i === msg.payload.length - 1);\n}\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 600,
        "y": 320,
        "wires": [
            [
                "1c107858ad11da45"
            ]
        ]
    }
]